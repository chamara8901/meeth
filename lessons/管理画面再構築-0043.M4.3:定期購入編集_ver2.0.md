# 1. [管理画面再構築](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E7%94%BB%E9%9D%A2%E4%B8%80%E8%A6%A7%28ver2.0%29) - M4.3:定期購入編集 機能設計書

- [1. 管理画面再構築 - M4.3:定期購入編集 機能設計書](#1-管理画面再構築---m43定期購入編集-機能設計書)
  - [1.1. 処理概要](#11-処理概要)
    - [1.1.1. 機能名](#111-機能名)
    - [1.1.2. 機能概要](#112-機能概要)
    - [1.1.3. 前提条件](#113-前提条件)
    - [1.1.4. 処理概要](#114-処理概要)
    - [1.1.5. パラメータ一覧](#115-パラメータ一覧)
    - [1.1.6. テーブル一覧](#116-テーブル一覧)
    - [1.1.7. ファイル一覧](#117-ファイル一覧)
  - [1.2. レイアウト](#12-レイアウト)
    - [1.2.1. 画面イメージ（現行）](#121-画面イメージ現行)
    - [1.2.2. 1.2.2-1. 画面イメージ（再構築）(編集)](#122-122-1-画面イメージ再構築編集)
    - [1.2.3. 1.2.2-2. 画面イメージ（再構築）(削除)](#123-122-2-画面イメージ再構築削除)
    - [1.2.4. 画面項目](#124-画面項目)
    - [1.2.5. イベント定義](#125-イベント定義)
    - [1.2.6. 1.3.1 API一覧](#126-131-api一覧)

## 1.1. 処理概要

### 1.1.1. 機能名
|  No.  |       項目       |         値          |
| :---: | :--------------: | :-----------------: |
|   1   |   プロジェクト   | meeth様ECサイト開発 |
|   2   |     システム     |      管理画面       |
|   3   |  画面プログラム  |    定期購入編集     |
|   4   | 画面プログラムID |        M4.3         |
|   5   |  画面フォーム名  |         N/A         |

### 1.1.2. 機能概要

- 定期購入の

### 1.1.3. 前提条件

- ログイン済のユーザであること
- ログインユーザの[権限](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E6%A8%A9%E9%99%90%E4%B8%80%E8%A6%A7)が条件を満たしていること(総合管理者、許可された作業担当者のみ閲覧・操作可能)

### 1.1.4. 処理概要
| No  | 操作                           | 処理概要                                                                         |
| --- | ------------------------------ | -------------------------------------------------------------------------------- |
| 1   | 初期表示時                     | 定期購入詳細が表示される                                                         |
| 2   | 編集ボタン押下時               | 定期購入プラン編集モーダルを表示する                                             |
| 3   | 変更内容を確定するボタン押下時 | 変更し定期購入詳細画面へ遷移する                                                 |
| 4   | 削除ボタン押下時               | アラート表示の上定期購入商品を削除する<br>商品が１つの時は削除出来ないようにする |

### 1.1.5. パラメータ一覧

| No  | 論理名称   | 物理名称        | I/O | 備考 |
| --- | ---------- | --------------- | --- | ---- |
| 1   | 定期購入ID | subscription_id | O   |      |

### 1.1.6. テーブル一覧
| No  | 論理名称                                                                                                                                      | 物理名称             | I/O | 備考 |
| --- | --------------------------------------------------------------------------------------------------------------------------------------------- | -------------------- | --- | ---- |
| 1   | [定期購入テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_subscriptions)                | subscriptions        | O   |      |
| 2   | [定期購入詳細情報テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_subscription_details) | subscription_details | O   |      |
| 3   | [定期購入プランテーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_subscription_details)   | subscription_details | O   |      |

### 1.1.7. ファイル一覧

なし

## 1.2. レイアウト
### 1.2.1. 画面イメージ（現行）
![image](https://user-images.githubusercontent.com/77314669/113244935-ee22da80-92f0-11eb-914d-f7cd10ea036c.png)



### 1.2.2. 1.2.2-1. 画面イメージ（再構築）(編集)
![image](https://user-images.githubusercontent.com/77314669/115327932-c675b280-a1ca-11eb-9715-bbc1d01bfa3e.png)
&dArr;
![image](https://user-images.githubusercontent.com/24938069/117793555-4b626200-b287-11eb-9600-e63604c7ceb0.png)



### 1.2.3. 1.2.2-2. 画面イメージ（再構築）(削除)


![image](https://user-images.githubusercontent.com/24938069/117793543-49000800-b287-11eb-857e-f63e1ce65b7a.png)


&dArr;
![image](https://user-images.githubusercontent.com/77314669/115328182-21a7a500-a1cb-11eb-8c88-d83390aea924.png)


### 1.2.4. 画面項目

| No  | 名称                 | 対応DB項目                                                              | I/O | 種別       | 型                | 桁数 | 必須 | バリデーション | 備考                                 |
| --- | -------------------- | ----------------------------------------------------------------------- | --- | ---------- | ----------------- | ---- | ---- | -------------- | ------------------------------------ |
| 1   | 定期購入プランの編集 | ー                                                                      | O   | ラベル     | ー                | ー   | ー   | ー             |                                      |
| 2   | 定期購入ID           | ー                                                                      | O   | リンク     | ー                | ー   | ー   | ー             |                                      |
|     |                      | subscriptions.id                                                        | O   | テキスト   | ー                | ー   | ー   | ー             | 定期購入詳細画面へのテキストリンク   |
| 3   | 商品名               | ー                                                                      | O   | ラベル     | ー                | ー   | ー   | ー             |                                      |
|     |                      | subscription_details.product_detail.product.name                        | O   | テキスト   | ー                | ー   | ー   | ー             |                                      |
| 4   | ご注文月             | ー                                                                      | O   | ラベル     | ー                | ー   | ー   | ー             |                                      |
|     |                      | ー                                                                      | O   | テキスト   | ー                | ー   | ー   | ー             | 次回変更可能月から６ヶ月間を表示する |
| 5   | 個数                 | ー                                                                      | O   | ラベル     | ー                | ー   | ー   | ー             |                                      |
|     |                      | subscription_details.quantity                                           | I   | プルダウン | integer<br>number | ー   | YES  | 自然数         |                                      |
| 6   | 毎月のご注文日       | ー                                                                      | O   | ラベル     | ー                | ー   | ー   | ー             |                                      |
|     |                      | subscriptions.delivery_plan                                             | O   | プルダウン | ー                | ー   | ー   | ー             |                                      |
| 7   | 契約状況             | ー                                                                      | O   | ラベル     | ー                | ー   | ー   | ー             |                                      |
|     |                      | 設計時に定期契約予定管理テーブルの新設を想定(subscription_plans.status) | O   | プルダウン | ー                | ー   | ー   | ー             | 「お休み」または「お届け」           |
| 8   | 変更内容を確定する   | ー                                                                      | O   | ボタン     | ー                | ー   | ー   | ー             |                                      |
| 9   | 削除                 | ー                                                                      | O   | ボタン     | ー                | ー   | ー   | ー             | 即時での解約処理を行う               |
| 10  | 削除アラート         | ー                                                                      | O   | テキスト   | ー                | ー   | ー   | ー             |                                      |
| 11  | xボタン              | ー                                                                      | O   | テキスト   | ー                | ー   | ー   | ー             | モーダルを閉じる                     |


### 1.2.5. イベント定義

| No  | 項目               | 発生条件 | 遷移先                                                                                                                                                                                                    | 備考 | API             |
| --- | ------------------ | -------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---- | --------------- |
| 1   | 編集               | クリック | 定期購入プラン編集モーダル                                                                                                                                                                                |      |                 |
| 2   | 変更内容を確定する | クリック | [定期購入詳細画面](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-0042.M4.2%3A%E5%AE%9A%E6%9C%9F%E8%B3%BC%E5%85%A5%E8%A9%B3%E7%B4%B0_ver2.0/_edit) |      | 定期購入更新API |
| 3   | 削除               | クリック | 削除アラート                                                                                                                                                                                              |      |                 |
| 4   | 削除アラート(OK)   | クリック | [定期購入詳細画面](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-0042.M4.2%3A%E5%AE%9A%E6%9C%9F%E8%B3%BC%E5%85%A5%E8%A9%B3%E7%B4%B0_ver2.0/_edit) |      | 定期購入更新API |

### 1.2.6. 1.3.1 API一覧
| NO. | 名称            | 内容                                           |
| --- | --------------- | ---------------------------------------------- |
| 1   | 定期購入更新API | 定期購入プランを更新し、その成功可否を返却する |
