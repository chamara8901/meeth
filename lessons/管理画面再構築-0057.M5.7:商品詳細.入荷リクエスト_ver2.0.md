# 1. [管理画面再構築](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E7%94%BB%E9%9D%A2%E4%B8%80%E8%A6%A7%28ver2.0%29) - M5.7:商品詳細.入荷リクエスト 機能設計書

- [1. 管理画面再構築 - M5.7:商品詳細.入荷リクエスト 機能設計書](#1-管理画面再構築---m57商品詳細入荷リクエスト-機能設計書)
  - [1.1. 処理概要](#11-処理概要)
    - [1.1.1. 機能名](#111-機能名)
    - [1.1.2. 機能概要](#112-機能概要)
    - [1.1.3. 前提条件](#113-前提条件)
    - [1.1.4. 処理概要](#114-処理概要)
    - [1.1.5. パラメータ一覧](#115-パラメータ一覧)
    - [1.1.6. テーブル一覧](#116-テーブル一覧)
    - [1.1.7. ファイル一覧](#117-ファイル一覧)
  - [1.2. レイアウト](#12-レイアウト)
    - [1.2.1. 画面イメージ（現行）](#121-画面イメージ現行)
    - [1.2.2. 画面イメージ（再構築）](#122-画面イメージ再構築)
    - [1.2.3. 画面項目](#123-画面項目)
    - [1.2.4. イベント定義](#124-イベント定義)
  - [1.3. API](#13-api)
    - [1.3.1. API一覧](#131-api一覧)

## 1.1. 処理概要

### 1.1.1. 機能名
| No. | 項目 | 値 |
|:---:|:----------------:|:-------------------:|
| 1 | プロジェクト | meeth様ECサイト開発 |
| 2 | システム | 管理画面 |
| 3 | 画面プログラム | 商品詳細.入荷リクエスト |
| 4 | 画面プログラムID | M5.7 |
| 5 | 画面フォーム名 | N/A |

### 1.1.2. 機能概要

- 入荷リクエストした顧客情報を表示する
- 顧客詳細画面へ遷移する
- ゆくゆくは、入荷時にメールを配信する

### 1.1.3. 前提条件

- ログイン済のユーザであること
- ログインユーザの[権限](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E6%A8%A9%E9%99%90%E4%B8%80%E8%A6%A7)が条件を満たしていること(総合管理者、許可された作業担当者のみ閲覧・操作可能)

### 1.1.4. 処理概要
| No | 操作 | 処理概要 |
|----|----------------------------------------------------|----------------------------------------------------------------------------------------------------------|
| 1 | 初期表示時 | 商品詳細及び入荷リクエストした顧客情報が表示される |
| 2 | 顧客IDを押下する | 顧客詳細画面に遷移する |

### 1.1.5. パラメータ一覧

| No | 論理名称 | 物理名称 | I/O | 備考 |
|----------------|----------|-----------|-----|------|
| 1 | 商品ID | product_id | O | |

### 1.1.6. テーブル一覧
| No | 論理名称 | 物理名称 | I/O | 備考 |
|----|------------------|-------------------|-----|------|
| 1 | [顧客情報テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_customers) | customers | O | |
| 2 | [顧客お届け先情報テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_customer_addresses) | customer_addresses | O | |
| 3 | 入荷リクエストテーブル | restock_requests | O | |

### 1.1.7. ファイル一覧

なし

## 1.2. レイアウト
### 1.2.1. 画面イメージ（現行）
![image](https://user-images.githubusercontent.com/77314669/114051178-d4bcf800-98c7-11eb-9e60-a05f36c21563.png)






### 1.2.2. 画面イメージ（再構築）
![image](https://user-images.githubusercontent.com/77314669/116344381-171b8a00-a821-11eb-883d-53dd51fe54a1.png)








### 1.2.3. 画面項目

| No   | 名称                        | 対応DB項目                                         | I/O   | 種別             | 型           | 桁数   | 必須   | バリデーション   | 備考                                               |
|------|-----------------------------|----------------------------------------------------|-------|------------------|--------------|--------|--------|------------------|----------------------------------------------------|
| 1  | 件数表示             | －                                            | O | ラベル   | － | － | － |   |                                                                                                                                                                                          |
| 2  | ページャー           | －                                            | O | リンク   | － | － | － |   |                                                                                                                                                                                          |
| 3  | 顧客ID               | －                                            | O | ラベル   | － | － | － |   |                                                                                                                                                                                          |
|    |                      | customers.customer_id                         | O | テキスト | － | － | － |   |                                                                                                                                                                                          |
| 4  | 名前                 | －                                            | O | ラベル   | － | － | － |   |                                                                                                                                                                                          |
|    |                      | customers.family_name<br>customers.first_name | O | テキスト | － | － | － |   |                                                                                                                                                                                          |
| 5  | 年齢                 | －                                            | O | ラベル   | － | － | － |   |                                                                                                                                                                                          |
|    |                      | customers.birthday                            | O | テキスト | － | － | － |   |                                                                                                                                                                                          |
| 6  | メールアドレス       | －                                            | O | ラベル   | － | － | － |   |                                                                                                                                                                                          |
|    |                      | customers.email                               | O | テキスト | － | － | － |   |                                                                                                                                                                                          |
| 7  | 注文数（定期）       | －                                            | O | ラベル   | － | － | － |   |                                                                                                                                                |
|    |                      | orders.id<br>orders.subscription_id           | O | テキスト | － | － | － |   |  orders.statusが3（完了）のidをカウントする                                                                                                                                                                                        |
| 8  | 商品購入金額（定期） | －                                            | O | ラベル   | － | － | － |   |                                                                                                                                         |
|    |                      | orders.total_amount<br>orders.subscription_id | O | テキスト | － | － | － |   | orders.statusが3（完了）のtotal_amountを表示する                                                                                                                                                                                          |
| 9 | 定期購入             | －                                            | O | ラベル   | － | － | － |   | subscriptions.processing_status=<br>1（処理中）<br>2（次回準備中）<br>3（一時停止）<br>の場合、「契約中」<br>subscriptions.processing_status=<br>4（解約）<br>の場合、「解約」を表示する |
|    |                      | subscriptions.processing_status               | O | テキスト | － | － | － |   | 定期購入がない場合は「ー」を表示する                                                                                                                                                     |
| 10 | 最終注文日           | －                                            | O | ラベル   | － | － | － |   |                                                                                                                                                |
|    |                      | orders.updated_at                             | O | テキスト | － | － | － |   |   orders.statusが3（完了）の場合のみ表示する                                                                                                                                                                                       |
| 11 | リクエスト日時           | －                                            | O | ラベル   | － | － | － |   |                                                                                                                                                |
|    |                      | restock_requests.created_at                             | O | テキスト | － | － | － |   |                                                                                                                                                                                          |

### 1.2.4. イベント定義

| No  | 項目           | 発生条件 | 遷移先 | 備考 | API |
| --- | -------------- | -------- | ------ | ---- | -- |
| 1   | 初期表示       | ー | ー       |      | 商品入荷リクエスト情報API |
| 2   | 顧客ID       | クリック | [顧客詳細画面](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-0061.M6.2:%E9%A1%A7%E5%AE%A2%E8%A9%B3%E7%B4%B0_ver2.0)       |      |  |


## 1.3. API

### 1.3.1. API一覧
| NO. | 名称 | 内容 |
|-|-|-|
| 1 | 商品入荷リクエスト情報API | 商品詳細に表示する入荷リクエスト情報を表示する |
