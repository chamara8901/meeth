# 1. [管理画面再構築](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E7%94%BB%E9%9D%A2%E4%B8%80%E8%A6%A7%28ver2.0%29) - M3.5:注文詳細.決済承認・発送処理開始/完了 機能設計書

- [1. 管理画面再構築 - M3.5:注文詳細.決済承認・発送処理開始/完了 機能設計書](#1-管理画面再構築---m35注文詳細決済承認発送処理開始完了-機能設計書)
  - [1.1. 処理概要](#11-処理概要)
    - [1.1.1. 機能名](#111-機能名)
    - [1.1.2. 機能概要](#112-機能概要)
    - [1.1.3. 前提条件](#113-前提条件)
    - [1.1.4. 処理概要](#114-処理概要)
    - [1.1.5. パラメータ一覧](#115-パラメータ一覧)
    - [1.1.6. テーブル一覧](#116-テーブル一覧)
    - [1.1.7. ファイル一覧](#117-ファイル一覧)
  - [1.2. レイアウト](#12-レイアウト)
    - [1.2.1. 画面イメージ（現行）](#121-画面イメージ現行)
    - [1.2.2-1. 画面イメージ（再構築）(決済承認)](#122-1-画面イメージ再構築決済承認)
    - [1.2.2-2. 画面イメージ（再構築）(発送処理開始/完了)](#122-2-画面イメージ再構築発送処理開始完了)
    - [1.2.3. 画面項目](#123-画面項目)
    - [1.2.4. イベント定義](#124-イベント定義)
  - [1.3. API](#13-api)
    - [1.3.1. API一覧](#131-api一覧)

## 1.1. 処理概要

### 1.1.1. 機能名
|  No.  |       項目       |         値          |
| :---: | :--------------: | :-----------------: |
|   1   |   プロジェクト   | meeth様ECサイト開発 |
|   2   |     システム     |      管理画面       |
|   3   |  画面プログラム  |      注文詳細       |
|   4   | 画面プログラムID |        M3.5         |
|   5   |  画面フォーム名  |         N/A         |

### 1.1.2. 機能概要

- 決済承認処理を行う。

### 1.1.3. 前提条件

- ログイン済のユーザであること
- ログインユーザの[権限](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E6%A8%A9%E9%99%90%E4%B8%80%E8%A6%A7)が条件を満たしていること(総合管理者、許可された作業担当者のみ閲覧・操作可能)

### 1.1.4. 処理概要

| No  | 操作                           | 処理概要                         |
| --- | ------------------------------ | -------------------------------- |
| 1   | 「決済承認」ボタン押下時       | 決済承認モーダルを表示する。     |
| 2   | 「発送処理を開始」ボタン押下時 | 発送処理開始モーダルを表示する。 |
| 3   | 「発送処理を完了」ボタン押下時 | 発送処理完了モーダルを表示する。 |

### 1.1.5. パラメータ一覧

| No  | 論理名称 | 物理名称 | I/O | 備考 |
| --- | -------- | -------- | --- | ---- |
| 1   | 注文ID   | order_id | O   |      |

### 1.1.6. テーブル一覧

| No  | 論理名称                                                                                                                  | 物理名称 | I/O | 備考 |
| --- | ------------------------------------------------------------------------------------------------------------------------- | -------- | --- | ---- |
| 1   | [支払管理テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_payments) | payments | O   |      |
| 2   | [注文テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_orders)       | orders   | O   |      |

### 1.1.7. ファイル一覧

なし

## 1.2. レイアウト
### 1.2.1. 画面イメージ（現行）



### 1.2.2-1. 画面イメージ（再構築）(決済承認)

![image](https://user-images.githubusercontent.com/77314669/114837502-bfd3ed80-9e0e-11eb-91c8-9f06ce69e827.png)
&dArr;
![image](https://user-images.githubusercontent.com/24938069/117916022-55d13a00-b321-11eb-8e83-b155ae077da9.png)
&dArr;
![image](https://user-images.githubusercontent.com/77314669/114837702-f578d680-9e0e-11eb-8aab-fb8d2b12b2e3.png)



### 1.2.2-2. 画面イメージ（再構築）(発送処理開始/完了)
![image](https://user-images.githubusercontent.com/77314669/114837860-1b05e000-9e0f-11eb-8dc0-abe279c5986d.png)
&dArr;
![image](https://user-images.githubusercontent.com/77314669/114837948-2f49dd00-9e0f-11eb-9da0-ef07297e6886.png)
&dArr;
![image](https://user-images.githubusercontent.com/77314669/114838010-3f61bc80-9e0f-11eb-91a8-c392a2b0e9fd.png)
&dArr;
![image](https://user-images.githubusercontent.com/24938069/118097751-0a488a00-b40e-11eb-9909-c6fd62d936cc.png)
&dArr;
![image](https://user-images.githubusercontent.com/77314669/114838125-59030400-9e0f-11eb-95e3-892a9782d444.png)



### 1.2.3. 画面項目

| No  | 名称                 | 対応DB項目                                                                                                                   | I/O | 種別     | 型  | 桁数 | 必須 | 備考                                                                                                                           |
| --- | -------------------- | ---------------------------------------------------------------------------------------------------------------------------- | --- | -------- | --- | ---- | ---- | ------------------------------------------------------------------------------------------------------------------------------ |
| 1   | 決済承認             | －                                                                                                                           | O   | ボタン   | －  | －   | －   | 決済承認モーダルを表示する<br>決済状況が振込待ちの場合のみ出現する                                                             |
| 2   | 確認                 | －                                                                                                                           | O   | ラベル   | －  | －   | －   |                                                                                                                                |
| 3   | 決済を承認します     | －                                                                                                                           | O   | テキスト | －  | －   | －   |                                                                                                                                |
| 4   | 承認                 | payments.status                                                                                                              | O   | ボタン   | －  | －   | －   | 決済承認を行う<br>決済状況を振込待ちから実売上に変更する<br>「決済承認」ボタンが「発送処理を開始」ボタンに変更                 |
| 5   | xボタン              | －                                                                                                                           | O   | ボタン   | －  | －   | －   | 決済承認モーダルを閉じる                                                                                                       |
| 6   | 発送処理を開始       | －                                                                                                                           | O   | ボタン   | －  | －   | －   | 発送処理開始モーダルを表示する                                                                                                 |
| 7   | 確認                 | －                                                                                                                           | O   | ラベル   | －  | －   | －   |                                                                                                                                |
| 8   | 発送処理を開始します | －                                                                                                                           | O   | テキスト | －  | －   | －   |                                                                                                                                |
| 9   | 開始                 | orders.shipping_status                                                                                                       | O   | ボタン   | －  | －   | －   | 発送処理を開始する<br>注文状況を未発送から発送処理中に変更する<br>「発送処理を開始」ボタンが「発送処理を完了」ボタンに変更する |
| 10  | xボタン              | －                                                                                                                           | O   | ボタン   | －  | －   | －   | 発送処理開始モーダルを閉じる                                                                                                   |
| 11  | 発送完了             | －                                                                                                                           | O   | ボタン   | －  | －   | －   | 発送処理完了モーダルを表示する                                                                                                 |
| 12  | 確認                 | －                                                                                                                           | O   | ラベル   | －  | －   | －   |                                                                                                                                |
| 13  | 発送処理を完了します | ー                                                                                                                           | O   | テキスト | －  | －   | －   |                                                                                                                                |
| 14  | 完了                 | orders.shipping_status<br>orders_detail.product_details.allocated_stock<br>orders_detail.product_detail.product_stocks.stock | O   | ボタン   | －  | －   | －   | 発送処理を完了する<br>注文状況を発送処理中から発送完了に変更する<br>在庫数、引当数を減算する                                   |
| 15  | xボタン              | －                                                                                                                           | O   | ボタン   | －  | －   | －   | 発送処理完了モーダルを閉じる                                                                                                   |

### 1.2.4. イベント定義

| No  | 項目                     | 発生条件 | 遷移先                                                                                                                                                                      | 備考                               | API                 |
| --- | ------------------------ | -------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------- | ------------------- |
| 1   | 「決済承認」ボタン       | クリック | 決済承認モーダル                                                                                                                                                            | 銀行振込決済に限る                 |                     |
| 2   | 「発送処理を開始」ボタン | クリック | 発送処理開始モーダル                                                                                                                                                        |                                    |                     |
| 3   | 「発送処理を完了」ボタン | クリック | 発送処理完了モーダル                                                                                                                                                        |                                    |                     |
| 4   | 「開始」ボタン           | クリック | [注文詳細画面](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-0032.M3.2:%E6%B3%A8%E6%96%87%E8%A9%B3%E7%B4%B0_ver2.0) | 処理を行い注文詳細画面を再描画する | 発送処理状況変更API |
| 6   | xボタン                  | クリック | ー                                                                                                                                                                          | モーダルを閉じる                   |                     |

## 1.3. API

### 1.3.1. API一覧

| NO. | 名称                | 内容                   |
| --- | ------------------- | ---------------------- |
| 1   | 発送処理状況変更API | 発送処理状況を変更する |
