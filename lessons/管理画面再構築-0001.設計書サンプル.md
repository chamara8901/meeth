# 1. [管理画面再構築](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-0000.%E7%94%BB%E9%9D%A2%E4%B8%80%E8%A6%A7) - M6.1:顧客管理 機能設計書

- [1. 管理画面再構築 - M6.1:顧客管理 機能設計書](#1-管理画面再構築---m61顧客管理-機能設計書)
  - [1.1. 処理概要](#11-処理概要)
    - [1.1.1. 機能名](#111-機能名)
    - [1.1.2. 機能概要](#112-機能概要)
    - [1.1.3. 前提条件](#113-前提条件)
    - [1.1.4. 処理概要](#114-処理概要)
    - [1.1.5. パラメータ一覧](#115-パラメータ一覧)
    - [1.1.6. テーブル一覧](#116-テーブル一覧)
    - [1.1.7. ファイル一覧](#117-ファイル一覧)
  - [1.2. レイアウト](#12-レイアウト)
    - [1.2.1. 画面イメージ(既存)](#121-画面イメージ既存)
    - [1.2.2. 画面イメージ(再構築)](#122-画面イメージ再構築)
    - [1.2.3. 画面項目](#123-画面項目)
    - [1.2.4. イベント定義](#124-イベント定義)
  - [1.3. エクスポートCSVフォーマット](#13-エクスポートcsvフォーマット)
  - [1.4. API](#14-api)
    - [1.4.1. API一覧](#141-api一覧)
    - [1.4.2. ほげAPI](#142-ほげapi)
      - [1.4.2.1. 概要](#1421-概要)
      - [1.4.2.2. リクエストパラメータ](#1422-リクエストパラメータ)
      - [1.4.2.3. レスポンスパラメータ](#1423-レスポンスパラメータ)
    - [1.4.3. ほぐAPI](#143-ほぐapi)
      - [1.4.3.1. 概要](#1431-概要)
      - [1.4.3.2. リクエストパラメータ](#1432-リクエストパラメータ)
      - [1.4.3.3. レスポンスパラメータ](#1433-レスポンスパラメータ)
  - [1.5. 処理仕様](#15-処理仕様)

## 1.1. 処理概要

### 1.1.1. 機能名

| No. | 項目 | 値 |
|:---:|:----------------:|:-------------------:|
| 1 | プロジェクト | meeth様ECサイト開発 |
| 2 | システム | 管理画面 |
| 3 | 画面プログラム | 顧客管理 |
| 4 | 画面プログラムID | M6.1 |
| 5 | 画面フォーム名 | 顧客検索 |

### 1.1.2. 機能概要
- 顧客情報を表示する。
- 顧客情報をCSVファイルにてエクスポートする。
- 顧客詳細画面に遷移する。

### 1.1.3. 前提条件
- 画面の閲覧権限があること。

### 1.1.4. 処理概要
| No | 操作 | 処理概要 |
| --- | ---------------------------------------------------- | -------------------------------------------------------------------------------------- |
| 1 | 初期表示時 | 全顧客を表示する。顧客数の表示件数は100件単位とする。 |
| 2 | 「検索：顧客ID・名前・メールアドレス」テキスト入力時 | 入力文字に該当する顧客を表示する。 |
| 3 | 「検索：年代」プルダウン選択時 | 選択した年代に該当する顧客を表示する。 |
| 4 | 「検索：誕生月」プルダウン選択時 | 選択した誕生月に該当する顧客を表示する。 |
| 5 | 「検索：DM可否」プルダウン選択時 | 選択したDM可否に該当する顧客を表示する。 |
| 6 | 「検索：購入回数」プルダウン選択時 | 選択した購入回数に該当する顧客を表示する。 |
| 7 | 「検索：定期購入」プルダウン選択時 | 選択した定期購入に該当する顧客を表示する。 |
| 8 | 「検索：購入金額」プルダウン選択時 | 選択した購入金額に該当する顧客を表示する。 |
| 9 | 「検索：最終購入日」プルダウン選択時 | 選択した最終購入日に該当する顧客を表示する。 |
| 10 | 「検索：名前（お届け先）」テキスト入力時 | 入力文字に該当する顧客を表示する。 |
| 11 | 「検索：郵便番号（お届け先）」テキスト入力時 | 入力文字に該当する顧客を表示する。 |
| 12 | 「検索：国・都道府県（お届け先）」プルダウン選択時 | 選択した国・都道府県に該当する顧客を表示する。 |
| 13 | 「検索：その他住所（お届け先）」テキスト入力時 | 入力文字に該当する顧客を表示する。 |
| 14 | 「CSVダウンロード」押下時 | 検索結果に応じたCSVを<br>エクスポートする。|
| 15 | 「詳細」押下時（顧客管理画面表示時） | 顧客詳細画面に遷移する。 |



### 1.1.5. パラメータ一覧

| No | 論理名称 | 物理名称 | I/O | 備考 |
| --- | ---------- | -------- | --- | ---- |
| 1 | | | | |
| 2 | | | | |
| 3 | | | | |

### 1.1.6. テーブル一覧
| No | 論理名称 | 物理名称 | I/O | 備考 |
| --- | --------------------------------------------------------------------------------------------------------------------------------------------- | --------------------- | --- | ---- |
| 1 | [顧客情報テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_customers) | customers | O | |
| 2 | [顧客住所テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_customer_addresses) | customer_addresses | O | |
| 3 | [定期注文基本情報テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_subscriptions) | subscriptions | O | |
| 4 | [定期注文詳細情報テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_subscription_details) | subscriptions_details | O | |
| 5 | [注文テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_orders) | orders | O | |

### 1.1.7. ファイル一覧

| No | 論理名称 | 物理名称 | I/O | 備考 |
| --- | ------------------- | ------------- | --- | ---- |
| 1 | 顧客管理CSVファイル | customers_csv | O | |
| 2 | | | | |

## 1.2. レイアウト

### 1.2.1. 画面イメージ(既存)

!![image](https://user-images.githubusercontent.com/24938069/111802845-cc4d4f00-8911-11eb-91f6-efcbeeba4528.png)

### 1.2.2. 画面イメージ(再構築)

![顧客管理画面修正イメージ_顧客検索画面_page-0001](https://user-images.githubusercontent.com/80737361/111581716-1b559000-87fd-11eb-9f15-4abf5d10766a.jpg)

### 1.2.3. 画面項目

| No | 名称 | 対応DB項目 | I/O | 種別 | 桁数 | 必須 | 備考 |
| --- | ---------------------------------- | ----------------------------------- | --- | ---------------- | ---- | ---- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1 | ページタイトル | － | O | ラベル | | | |
| 2 | ユーザーID | － | O | ラベル | | | |
| 3 | 検索：顧客ID・名前・メールアドレス | － | I | テキストボックス | | | |
| 4 | 検索：年代 | － | I | プルダウン | | | |
| 5 | 検索：誕生月 | － | I | プルダウン | | | |
| 6 | 検索：DM可否 | － | I | プルダウン | | | |
| 7 | 検索：購入回数 | － | I | プルダウン | | | |
| 8 | 検索：定期購入 | － | I | プルダウン | | | |
| 9 | 検索：購入金額 | － | I | プルダウン | | | |
| 10 | 検索：最終購入日 | － | I | プルダウン | | | |
| 11 | 検索：名前（お届け先） | － | I | テキストボックス | | | |
| 12 | 検索：郵便番号（お届け先） | － | I | テキストボックス | | | |
| 13 | 検索：国・都道府県 | － | I | プルダウン | | | |
| 14 | 検索：その他住所 | － | I | テキストボックス | | | |
| 15 | 検索 | － | I | ボタン | | | |
| 16 | CSVダウンロード | － | I | ボタン | | | |
| 17 | ページ遷移 | － | I | ボタン | | | |
| 18 | 顧客ID | 顧客の住所.顧客ID | O | ラベル | | | |
| 19 | 名前 | 顧客情報.姓.名 | O | ラベル | | | |
| 20 | 年齢 | 顧客情報.誕生日 | O | ラベル | | | |
| 21 | メールアドレス | 顧客情報.メールアドレス | O | ラベル | | | |
| 22 | 購入回数（定期回数） | 注文.ID | O | ラベル | | | 注文.ステータスが完了の場合<br>IDをカウントする。 |
| 23 | 購入金額（定期金額） | 注文.合計金額 | O | ラベル | | | 注文.ステータスが完了の場合<br>表示する。 |
| 24 | 定期購入 | 定期注文基本情報.プロセスステータス | O | ラベル | | | 定期注文基本情報.プロセスステータス<br>1（処理中）<br>2（次回準備中）<br>3（一時停止）<br>の場合、「契約中」<br>定期注文基本情報.プロセスステータス=<br>4（解約）<br>の場合、「解約」を表示 |
| 25 | 最終年月日 | 注文.レコード生成日時 | O | ラベル | | | 注文.ステータスが完了の場合<br>表示する。 |
| 26 | 詳細 | － | I | ボタン | | | |

### 1.2.4. イベント定義

| No | 項目 | 発生条件 | 遷移先 | 備考 |
| --- | ---------------------------------- | ------------ | -------------------- | ------------------------------------------------------- |
| 1 | 検索| クリック | － |検索条件に応じた検索結果を表示 |
| 2 | CSVダウンロード | クリック | － | 検索条件に応じたCSVを<br>エクスポート |
| 3 | ページャー | クリック | 指定したページ | | |
| 4 | 詳細 | クリック | 顧客詳細画面 | |

## 1.3. ダウンロードCSVフォーマット

- フォーマット
```csv
id,email,password_digest,remember_token,family_name,first_name,birthday,gender,dm_agreed,status,password_reset_digest,password_reset_issued_at,created_at,updated_at,activation_digest,activated,activation_issued_at,mail_address_update_digest,mail_address_update_issued_at,temporary_email_address,card_registered,from_shopify,pw_update_completed,delivery_plan_reset_completed,movement_digest,movement_issued_at
1354148390023204866,dummy@meeth.store,$2a$12$7JO1SRiBL5vXRq3DTivVTu3KmXxmm8pO5slUHQgJxOpPicdatYPOm,,Dummy,Grrow,1990-01-01,2,1,1,c53408caacb4a0019670d55499753ff8438377080bc00cc109e5bb9dc34674b2,2021-02-04 00:20:37,2021-01-27 04:25:09.699073000,2021-01-27 04:25:09.699073000,275d84c23a1d4166c65cd2b84a0d68642ef9d8713bc067587bc2b9424a3620c0,1,2021-01-27 04:25:09,,,,0,0,,,,
1354151507297046530,bb78.x4@hotmail.co.jp,$2a$12$XxMIILQRYYOgl2Nb0Ef1qeNX6xebdbBeyN3bc9gpxfXTVuG2sDttC,,江畑,佳世,1999-01-01,9,0,1,,,2021-01-27 04:37:32.915115000,2021-01-27 04:37:32.915115000,e31580a5339b0ad3792a1eb11b047c5f767be2c30b24ef1d88a704577e1efd0c,0,,,,,0,1,,,,
1354151508387565571,ghitorres89@gmail.com,$2a$12$OeIsLXvI2NHSKnRParaokuvzbznhGk8xSmGgvCct3slYS76J8MlCS,,市石,仁美,1999-01-01,9,1,1,,,2021-01-27 04:37:33.175122000,2021-01-27 04:37:33.175122000,2633e7eb3dbc8356a427d4d916de7044d1ef9f4c8e562f68ebbb0781157ece64,0,,,,,0,1,,,,
```

## 1.4. API

### 1.4.1. API一覧
| NO. | 名称 | 内容 |
|-|-|-|
| 1 | ほげAPI | 説明説明説明説明説明説明 |
| 2 | ほぐAPI | 説明説明説明説明説明説明 |

### 1.4.2. ほげAPI

#### 1.4.2.1. 概要
| NO. | 名称 | 内容 |
|-|-|-|
| 1 | API概要 | まるまるするAPI |
| 2 | スキーマ | /api/xxxxx/yyyyyy |

#### 1.4.2.2. リクエストパラメータ

| NO | パラメータ名 | パラメータ名 | 値(例) | 説明 |
|-|-|-|-|-|
| 1 | サンプルパラメータ１ | xxxxxxx | xxxxxyyyyyzz | 説明説明説明説明説明 |
| 2 | サンプルパラメータ２ | yyyyyyy | aaa@b.com| 説明説明説明説明説明 |

-リクエスト例
```json
{
 xxxxxxx:"xxxxxyyyyyzz"
 yyyyyyy:"aaa@b.com"
}
```

#### 1.4.2.3. レスポンスパラメータ

| NO | パラメータ名 | パラメータ名 | 値(例) | 説明 |
|-|-|-|-|-|
| 1 | サンプルパラメータ１ | xxxxxxx | xxxxxyyyyyzz | 説明説明説明説明説明 |
| 2 | サンプルパラメータ２ | yyyyyyy | aaa@b.com| 説明説明説明説明説明 |


- レスポンス例
```json
{
 xxxxxxx:"xxxxxyyyyyzz"
 yyyyyyy:"aaa@b.com"
}
```


### 1.4.3. ほぐAPI

#### 1.4.3.1. 概要
| NO. | 名称 | 内容 |
|-|-|-|
| 1 | [API概要](https://github.com/grrowjp/Meeth/wiki/%E5%80%89%E5%BA%AB%E9%80%A3%E6%90%BA-%E7%99%BA%E9%80%81%E6%B8%88%E3%81%BF%E3%83%87%E3%83%BC%E3%82%BF%E5%8F%96%E8%BE%BC) | まるまるするAPI |
| 2 | スキーマ | /api/xxxxx/yyyyyy |

#### 1.4.3.2. リクエストパラメータ

| NO | パラメータ名 | パラメータ名 | 値(例) | 説明 |
|-|-|-|-|-|
| 1 | サンプルパラメータ１ | xxxxxxx | xxxxxyyyyyzz | 説明説明説明説明説明 |
| 2 | サンプルパラメータ２ | yyyyyyy | aaa@b.com| 説明説明説明説明説明 |

-リクエスト例
```json
{
 xxxxxxx:"xxxxxyyyyyzz"
 yyyyyyy:"aaa@b.com"
}
```

#### 1.4.3.3. レスポンスパラメータ

| NO | パラメータ名 | パラメータ名 | 値(例) | 説明 |
|-|-|-|-|-|
| 1 | サンプルパラメータ１ | xxxxxxx | xxxxxyyyyyzz | 説明説明説明説明説明 |
| 2 | サンプルパラメータ２ | yyyyyyy | aaa@b.com| 説明説明説明説明説明 |


- レスポンス例
```json
{
 xxxxxxx:"xxxxxyyyyyzz"
 yyyyyyy:"aaa@b.com"
}
```


## 1.5. 処理仕様

| No. | オブジェクト | イベント | 処理区分 | 処理仕様 | 備考 |
| --- | ------------ | -------- | -------- | -------- | ---- |
| 1 | | | | |
| 2 | | | | |
| 3 | | | | |
| 4 | | | | |
| 5 | | | | |
| 6 | | | | |
| 7 | | | | |
| 8 | | | | |
| 9 | | | | |
| 10 | | | | |