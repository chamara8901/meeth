# 1. [管理画面再構築](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E7%94%BB%E9%9D%A2%E4%B8%80%E8%A6%A7) - M6.1:顧客管理_ver1.0 機能設計書

- [1. 管理画面再構築 - M6.1:顧客管理_ver1.0 機能設計書](#1-管理画面再構築---m61顧客管理_ver10-機能設計書)
  - [1.1. 処理概要](#11-処理概要)
    - [1.1.1. 機能名](#111-機能名)
    - [1.1.2. 機能概要](#112-機能概要)
    - [1.1.3. 前提条件](#113-前提条件)
    - [1.1.4. 処理概要](#114-処理概要)
    - [1.1.5. パラメータ一覧](#115-パラメータ一覧)
    - [1.1.6. テーブル一覧](#116-テーブル一覧)
    - [1.1.7. ファイル一覧](#117-ファイル一覧)
  - [1.2. レイアウト](#12-レイアウト)
    - [1.2.1. 画面イメージ](#121-画面イメージ)
    - [1.2.3. 画面項目](#123-画面項目)
    - [1.2.4. イベント定義](#124-イベント定義)
  - [1.3. ダウンロードCSVフォーマット](#13-ダウンロードcsvフォーマット)

  - [1.5. 処理仕様](#15-処理仕様)

## 1.1. 処理概要

### 1.1.1. 機能名

|  No.  |       項目       |         値          |
| :---: | :--------------: | :-----------------: |
|   1   |   プロジェクト   | meeth様ECサイト開発 |
|   2   |     システム     |      管理画面       |
|   3   |  画面プログラム  |      顧客管理       |
|   4   | 画面プログラムID |        M6.1         |
|   5   |  画面フォーム名  |      顧客検索       |

### 1.1.2. 機能概要
- 顧客情報を表示する。
- 顧客情報をCSVファイルにてエクスポートする。
- 顧客詳細画面に遷移する。

### 1.1.3. 前提条件
- ログイン済のユーザであること

### 1.1.4. 処理概要
| No 	| 操作 	| 処理概要 	|
|-	|-	|-	|
| 1 	| 初期表示時 	| 全顧客を表示する。顧客数の表示件数は100件単位とする。 	|
| 2 	| 1.「検索：顧客ID」項目にテキスト入力<br>2. 検索ボタンを押下 	| 顧客IDに完全一致となる顧客を表示する。 	|
| 3 	| 1.「検索：名前」項目にテキスト入力<br>2. 検索ボタンを押下 	| 名前に部分一致となる顧客を表示する。 	|
| 4 	| 1.「検索：メールアドレス」項目にテキスト入力<br>2. 検索ボタンを押下 	| メールアドレスに部分一致となる顧客を表示する。 	|
| 5 	| 1.「検索：国」項目をプルダウン<br>2. 検索ボタンを押下 	| 選択した国に該当する顧客を表示する。 	|
| 6 	| 1.「検索：都道府県」項目をプルダウン<br>2. 検索ボタンを押下 	| 選択した都道府県に該当する顧客を表示する。 	|
| 7 	| 1.「検索：住所」項目にテキストを入力<br>2. 検索ボタンを押下 	| 選択した住所に該当する顧客を表示する。 	|
| 8 	| 1.「検索：性別」項目をプルダウン<br>2. 検索ボタンを押下 	| 選択した性別に該当する顧客を表示する。 	|
| 9 	| 1.「検索：年代」項目をプルダウン<br>2. 検索ボタンを押下 	| 選択した年代に該当する顧客を表示する。 	|
| 10 	| 1.「検索：誕生月」項目をプルダウン<br>2. 検索ボタンを押下 	| 選択した誕生月に該当する顧客を表示する。 	|
| 11 	| 1.「検索：DM可否」項目をプルダウン<br>2. 検索ボタンを押下 	| 選択したDM可否に該当する顧客を表示する 	|
| 12 	| 1.「検索：購入回数」を入力する。<br>2. 以下、一致、以上いずれかを選択する。<br>3. 検索ボタンを押下 	| 選択した購入回数に該当する顧客を表示する。 	|
| 13 	| 1.「検索：定期購入」を入力する。<br>2. 以下、一致、以上いずれかを選択する。<br>3. 検索ボタンを押下 	| 選択した定期購入に該当する顧客を表示する。 	|
| 14 	| 1.「検索：購入金額」を入力する。<br>2. 以下、一致、以上いずれかを選択する。<br>3. 検索ボタンを押下 	| 選択した購入金額に該当する顧客を表示する。 	|
| 15 	| 1.「検索：最終購入日」を入力する。<br>2. 検索ボタンを押下 	| 選択した最終購入日に該当する顧客を表示する。 	|
| 16 	| 1.「CSVダウンロード」押下<br>2. 検索ボタンを押下 	| 検索結果に応じたCSVをエクスポートする。 	|
| 17 	| 「詳細」押下時（顧客管理画面表示時） 	| 顧客詳細画面に遷移する。 	|
### 1.1.5. パラメータ一覧

なし

### 1.1.6. テーブル一覧

| No  | 論理名称                                                                                                                               | 物理名称           | I/O | 備考 |
| --- | -------------------------------------------------------------------------------------------------------------------------------------- | ------------------ | --- | ---- |
| 1   | [顧客情報テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_customers)             | customers          | O   |      |
| 2   | [顧客住所テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_customer_addresses)    | customer_addresses | O   |      |
| 3   | [定期注文基本情報テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_subscriptions) | subscriptions      | O   |      |
| 4   | [注文テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_orders)                    | orders             | O   |      |

### 1.1.7. ファイル一覧

| No  | 論理名称            | 物理名称                            | I/O | 備考 |
| --- | ------------------- | ----------------------------------- | --- | ---- |
| 1   | 顧客管理CSVファイル | customers_report_yyyymmddhhmmss.csv | O   |      |
| 2   |                     |                                     |     |      |

## 1.2. レイアウト

### 1.2.1. 画面イメージ 

- 値はサンプルです

![image](https://github.com/grrowjp/Meeth/wiki/images/admin/v1/M6_1_v1.png)

### 1.2.3. 画面項目

| No  | 名称                               | 対応DB項目                                    | I/O | 種別             | 型      | 桁数 | 必須(YES/NO) | バリデーション                                                             | 備考                                                                                                                                                                                              |
| --- | ---------------------------------- | --------------------------------------------- | --- | ---------------- | ------- | ---- | ------------ | -------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1   | ページタイトル                     | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
| 2   | ユーザーID                         | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
| 3   | 検索：顧客ID                       | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    |                                               | I   | テキストボックス | string  | 255  | NO           | 桁数上限制限                                                               | 完全一致で検索する                                                                                                                                                                                |
| 4   | 検索：名前                         | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    |                                               | I   | テキストボックス | string  | 255  | NO           | 桁数上限制限                                                               | 部分一致で検索する                                                                                                                                                                                |
| 5   | 検索：メールアドレス               | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    |                                               | I   | テキストボックス | string  | 255  | NO           | 桁数上限制限                                                               | 部分一致で検索する                                                                                                                                                                                |
| 6   | 検索：国（お届け先）               | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    |                                               | I   | プルダウン       | string  | 10   | NO           | 桁数上限制限                                                               | 国名を選択時、選択した国に応じて都道府県の表示内容が変動するようにする                                                                                                                            |
| 7   | 検索：都道府県（お届け先）         | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    |                                               | I   | プルダウン       | string  | 10   | NO           | 桁数上限制限                                                               | 国名を選択時、選択した国に応じて表示内容が変動するようにする(日本であれば都道府県、アメリカであれば州になるなど)                                                                                  |
| 8   | 検索：住所（お届け先）             | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    |                                               | I   | テキストボックス | string  | 255  | NO           | 桁数上限制限                                                               |                                                                                                                                                                                                   |
| 9   | 検索：性別                         | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    |                                               | I   | プルダウン       | integer | 1    | NO           | 桁数上限制限                                                               |                                                                                                                                                                                                   |
| 10  | 検索：年代                         | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    |                                               | I   | プルダウン       | integer | 2    | NO           | 型一致型一致<br> 桁数上限制限                                              | 【10歳代,20歳代,30歳代,40歳代,50歳代,60歳代,70歳代,80歳代,90歳代】から選択する                                                                                                                    |
| 11  | 検索：誕生月                       | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    |                                               | I   | プルダウン       | integer | 2    | NO           | 型一致<br> 桁数上限制限                                                    | 【1月,2月,3月,4月,5月,6月,7月,8月,9月,10月,11月,12月】から選択する                                                                                                                                |
| 12  | 検索：DM可否                       | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    |                                               | I   | プルダウン       | boolean | －   | NO           |                                                                            | 【許可,拒否】から選択する                                                                                                                                                                         |
| 13  | 検索：購入回数                     | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    |                                               | I   | テキストボックス | integer | 20   | NO           | 型一致<br> 桁数上限制限                                                    |                                                                                                                                                                                                   |
|     |                                    |                                               | I   | プルダウン       | integer | 1    | NO           | 購入回数が入力されている場合は必須<br> 桁数上限制限                        | 【以下,一致,以上】から選択する                                                                                                                                                                    |
| 14  | 検索：定期購入                     | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    |                                               | I   | テキストボックス | integer | 20   | NO           | 型一致<br> 桁数上限制限                                                    |                                                                                                                                                                                                   |
|     |                                    |                                               | I   | プルダウン       | integer | 1    | NO           | 定期購入が入力されている場合は必須<br> 桁数上限制限                        | 【以下,一致,以上】から選択する                                                                                                                                                                    |
| 15  | 検索：購入金額                     | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    |                                               | I   | テキストボックス | integer | 20   | NO           | 型一致<br> 桁数上限制限                                                    |                                                                                                                                                                                                   |
|     |                                    |                                               | I   | プルダウン       | integer | 1    | NO           | 購入金額が入力されている場合は必須<br> 桁数上限制限                        | 【以下,一致,以上】から選択する                                                                                                                                                                    |
| 16  | 検索：最終購入日                   | －                                            | I   | ボタン           | －      | －   | NO           | 購入日の期間に両方入力されている場合は、開始より終了が前でなければならない | カレンダーアイコン押下でカレンダーがポップアップ表示され、カレンダー内の日付を選択することでフォーム部分に日付が反映される<br> フォーム部分に直接入力は不可だが、反映された日付の削除は可能とする |
|     |                                    | －                                            | I   | ボタン           | －      | －   | NO           | 購入日の期間に両方入力されている場合は、開始より終了が前でなければならない | カレンダーアイコン押下でカレンダーがポップアップ表示され、カレンダー内の日付を選択することでフォーム部分に日付が反映される<br> フォーム部分に直接入力は不可だが、反映された日付の削除は可能とする |
| 17  | 検索                               | －                                            | I   | ボタン           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
| 18  | メールを配信する                   | －                                            | I   | ボタン           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
| 19  | CSVダウンロード                    | －                                            | I   | ボタン           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
| 20  | ページャー                         | －                                            | I   | ボタン           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
| 21  | 件数表示                           | －                                            | O   | テキスト         | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
| 22  | 顧客ID                             | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    | customer_addresses.customer_id                | O   | テキスト         | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
| 23  | 名前                               | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    | customers.family_name<br>customers.first_name | O   | テキスト         | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
| 24  | 年齢                               | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    | customers.birthday                            | O   | テキスト         | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
| 25  | 性別                               | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    | customers.gender                              | O   | テキスト         | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
| 26  | メールアドレス                     | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    | customers.email                               | O   | テキスト         | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
| 27  | 購入回数                           | －                                            | O   | ラベル           | －      | －   | －           |                                                                            | orders.statusが3（完了）のidをカウントする                                                                                                                                                        |
|     |                                    | orders.id                                     | O   | テキスト         | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
| 28  | 定期購入                           | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    | orders.id                                     | O   | テキスト         | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
| 29  | 購入金額                           | －                                            | O   | ラベル           | －      | －   | －           |                                                                            | orders.statusが3（完了）のtotal_amountを表示する                                                                                                                                                  |
|     |                                    | orders.total_amount                           | O   | テキスト         | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
| 30  | 国                                 | －                                            | O   | ラベル           | －      | －   | －           |                                                                            | subscriptions.processing_status=<br>1（処理中）<br>2（次回準備中）<br>3（一時停止）<br>の場合、「契約中」<br>subscriptions.processing_status=<br>4（解約）<br>の場合、「解約」を表示する          |
|     |                                    | customer_addresses.country                    | O   | テキスト         | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
| 31  | 都道府県                           | －                                            | O   | ラベル           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
|     |                                    | customer_addresses.prefecture                 | O   | テキスト         | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
| 32  | 最終購入日                         | －                                            | O   | ラベル           | －      | －   | －           |                                                                            | orders.statusが3（完了）の場合のみ表示する                                                                                                                                                        |
|     |                                    | orders.created_at                             | O   | テキスト         | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |
| 33  | 詳細                               | －                                            | O   | リンク           | －      | －   | －           |                                                                            |                                                                                                                                                                                                   |

### 1.2.4. イベント定義

| No  | 項目            | 発生条件 | 遷移先         | 備考                              |
| --- | --------------- | -------- | -------------- | --------------------------------- |
| 1   | 検索            | クリック | －             | 検索条件に応じた検索結果を表示    |
| 2   | CSVダウンロード | クリック | －             | 検索条件に応じたCSVをエクスポート |
| 3   | ページャー      | クリック | 指定したページ |                                   |  |
| 4   | 詳細          | クリック | 顧客詳細画面   |                                   |

## 1.3. ダウンロードCSVフォーマット

| 顧客ID              | 名前       | 年齢 | 性別   | メールアドレス         | 購入回数 | 定期購入 | 購入金額 | 国   | 都道府県 | 最終購入日 |
| ------------------- | ---------- | ---- | ------ | ---------------------- | -------- | -------- | -------- | ---- | -------- | ---------- |
| 1354151091180146709 | 水島　麻未 | 22   | 無回答 | dummy@meeth.store.test | 21       | 16       | 381000   | 日本 | 東京都   | 2021-01-01 |

```csv
顧客ID,名前,年齢,性別,メールアドレス,購入回数,定期購入,購入金額,国,都道府県,最終購入日
1354151091180146709,水島　麻未,22,無回答,dummy@meeth.store.test,21,16,381000,日本,東京都,2021-01-01
```