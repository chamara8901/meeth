# 1. [管理画面再構築](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-0000.%E7%94%BB%E9%9D%A2%E4%B8%80%E8%A6%A7) - M6.7:顧客詳細 . 変更履歴 機能設計書



## 1.1. 処理概要

### 1.1.1. 機能名- [1. 管理画面再構築 - M6.7:顧客詳細 . 変更履歴 機能設計書](#1-管理画面再構築---m67顧客詳細--変更履歴-機能設計書)
  - [1.1. 処理概要](#11-処理概要)
    - [1.1.1. 機能名](#111-機能名)
    - [1.1.2. 機能概要](#112-機能概要)
    - [1.1.3. 前提条件](#113-前提条件)
    - [1.1.4. 処理概要](#114-処理概要)
    - [1.1.5. パラメータ一覧](#115-パラメータ一覧)
    - [1.1.6. テーブル一覧](#116-テーブル一覧)
    - [1.1.7. ファイル一覧](#117-ファイル一覧)
  - [1.2. レイアウト](#12-レイアウト)
    - [1.2.1. 画面イメージ（現行）](#121-画面イメージ現行)
    - [1.2.2. 画面イメージ（再構築）](#122-画面イメージ再構築)
    - [1.2.3. 画面項目](#123-画面項目)
  - [1.3. API](#13-api)
    - [1.3.1. API一覧](#131-api一覧)
    - [1.3.2. 顧客編集API](#132-顧客編集api)
      - [1.3.2.1. 概要](#1321-概要)
      - [1.3.2.2. リクエストパラメータ](#1322-リクエストパラメータ)
      - [1.3.2.3. レスポンスパラメータ](#1323-レスポンスパラメータ)
  - [1.4. 処理仕様](#14-処理仕様)
| No. | 項目 | 値 |
|:---:|:----------------:|:-------------------:|
| 1 | プロジェクト | meeth様ECサイト開発 |
| 2 | システム | 管理画面 |
| 3 | 画面プログラム | 顧客詳細 |
| 4 | 画面プログラムID | M6.7 |
| 5 | 画面フォーム名 | N/A |

### 1.1.2. 機能概要
- ユーザーの登録情報編集


### 1.1.3. 前提条件
- ログイン済のユーザであること
- ログインユーザの権限が下記条件を満たしていること(当画面はフルアクセスか注文・顧客対応者のみ閲覧・操作が可能)

|              | ダッシュボード | 売上 | 注文 | 定期購入 | 商品・在庫 | 顧客 | メール | お知らせ | 配送料 |
|--------------|----------------|------|------|----------|------------|------|--------|----------|--------|
| フルアクセス | ◯              | ◯    | ◯    | ◯        | ◯          | ◯    | ◯      | ◯        | ◯      |
| 売上分析者     | ◯              | ◯    |      |          |            |      |        |          |        |
| 注文・顧客対応者     |                |      | ◯    | ◯        |            | ◯    | ◯      | ◯        |        |
| 在庫・発送業務者     |                |      |      |          | ◯          |      |        |          | ◯        |
| コンテンツ管理者     |                |      |      |          |          |      |   ◯     |     ◯     |        |

### 1.1.4. 処理概要
| No | 操作 | 処理概要 |
|----|----------------------------------------------------|----------------------------------------------------------------------------------------------------------|
| 1 | 初期表示時 | 顧客検索画面にて選択された顧客の詳細情報を表示する。 |
| 2 | 「注文一覧」押下時 | 注文一覧を表示する。 |
| 3 | 「すべての注文または定期購入のみ」プルダウン選択時 | 選択された条件にて表示する。 |
| 4 | 「詳細」押下時（顧客詳細画面注文一覧タブ選択時） | 注文詳細画面に遷移する。 |
| 5 | 「定期購入」押下時 | 定期購入を表示する。 |
| 6 | 「詳細」押下時（顧客詳細画面定期購入タブ選択時） | 定期購入詳細画面に遷移する。 |
| 7 | 「入荷リクエスト」押下時 | 入荷リクエストを表示する。 |
| 8 | 「お届け先」押下時 | お届け先を表示する。 |

### 1.1.5. パラメータ一覧

| No | 論理名称 | 物理名称 | I/O | 備考 |
|----------------|----------|-----------|-----|------|
| 1 | | | | |

### 1.1.6. テーブル一覧
| No | 論理名称 | 物理名称 | I/O | 備考 |
|----|------------------|-------------------|-----|------|
| 1 | [顧客情報テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_customers) | customers | O | |
| 2 | [顧客住所テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_customer_addresses) | customer_addresses | O | |
| 3 | [定期注文基本情報テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_subscriptions) | subscriptions | O | |
| 4 | [定期注文詳細情報テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_subscription_details) | subscriptions_details | O | |

### 1.1.7. ファイル一覧

| No | 論理名称 | 物理名称 | I/O | 備考 |
|----------------|----------|-----------|-----|------|
| 1 | | | | |

## 1.2. レイアウト
### 1.2.1. 画面イメージ（現行）
なし

### 1.2.2. 画面イメージ（再構築）
![image](https://user-images.githubusercontent.com/77314669/113792923-0c218c80-9782-11eb-9b96-8adaa22b879c.png)






### 1.2.3. 画面項目

| No | 名称     | 対応DB項目 | I/O | 種別   | 桁数 | 必須 | 備考 |
|----|----------|------------|-----|--------|------|------|------|


## 1.3. API

### 1.3.1. API一覧
| NO. | 名称 | 内容 |
|-|-|-|
| 1 | 顧客編集API | 顧客情報の編集を行うAPI |

### 1.3.2. 顧客編集API

#### 1.3.2.1. 概要
| NO. | 名称 | 内容 |
|-|-|-|
| 1 | API概要 | 顧客編集API |
| 2 | スキーマ | /api/customer/putCustomerUpdate |

#### 1.3.2.2. リクエストパラメータ

| NO | パラメータ名 | パラメータ名 | 値(例) | 説明 |
|-|-|-|-|-|
| 1   | ヘッダ               | header        |                                                              | ヘッダ部分に格納するもの                                                                                                                                                                                                        |
| 1-1 | アクセストークン     | access_token  | in:header schema:string(185795123454345fdfgeg) required:true | access_token                                                                                                                                                                                                                    |
| 1-2 | リフレッシュトークン | refresh_token | in:header schema:string(185795123454345fdfgeg)               | 【refresh_tokenの値があり、access_tokenの有効期限が切れた場合】 access_tokenとrefresh_tokenが新しい値に更新される  【refresh_tokenの値がなく、access_tokenの有効期限が切れた場合】 レスポンスのresultの値がredirectで返却される |
| 2   | ボディ               | body          |                                                              | ボディ部分に格納するもの                                                                                                                                                                                                        |
| 2-1 | メール               | email         | string(aaa@b.com)                                            | メール                                                                                                                                                                                                                          |
| 2-2 | DM可否               | dm_agreed     | boolean(true)                                                  | DM可否                                                                                                                                                                                                                          |
| 2-3 | 名前(姓)             | family_name   | string(ほげ)                                                   | 名前(姓)                                                                                                                                                                                                                        |
| 2-4 | 名前(名)             | first_name    | string(太郎)                                                | 名前(名)                                                                                                                                                                                                                        |
| 2-5 | 誕生日               | birthday      | string(2020/01/01)                                                   | 誕生日                                                                                                                                                                                                                          |

-リクエスト例
```json
{
 "email":"aaa@b.com"
 "dm_agreed":1
 "family_name":"ほげ"
 "first_name":"太郎"
 "birthday":"2020/01/01"
}
```

#### 1.3.2.3. レスポンスパラメータ

| NO | パラメータ名 | パラメータ名 | 値(例) | 説明 |
|-|-|-|-|-|
|   1 | 処理結果   | result  | array             | 結果の連想配列(JSONのオブジェクト型) |
| 1-1 | ステータス | status  | string(success) | ステータス                           |
| 1-2 | コード     | code    | integer(0)        | コード                               |
| 1-3 | メッセージ | message | string(正常)      | メッセージ                           |


- レスポンス例
```json
{
 "result":{
   "status":"success"
   "code":0
   "message":"正常"
 }
}
```

## 1.4. 処理仕様

| No. | オブジェクト | イベント | 処理区分 | 処理仕様 | 備考 |
|-----|------------------------|----------------------|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
| 1 | | | | |
| 2 | | | | |
| 3 | | | | |
| 4 | | | | |
| 5 | | | | |
| 6 | | | | |
| 7 | | | | |
| 8 | | | | |
| 9 | | | | |
| 10 | | | | |