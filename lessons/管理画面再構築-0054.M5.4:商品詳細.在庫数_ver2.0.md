# 1. [管理画面再構築](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E7%94%BB%E9%9D%A2%E4%B8%80%E8%A6%A7%28ver2.0%29) - M5.4:商品詳細.在庫数 機能設計書

- [1. 管理画面再構築 - M5.4:商品詳細.在庫数 機能設計書](#1-管理画面再構築---m54商品詳細在庫数-機能設計書)
  - [1.1. 処理概要](#11-処理概要)
    - [1.1.1. 機能名](#111-機能名)
    - [1.1.2. 機能概要](#112-機能概要)
    - [1.1.3. 前提条件](#113-前提条件)
    - [1.1.4. 処理概要](#114-処理概要)
    - [1.1.5. パラメータ一覧](#115-パラメータ一覧)
    - [1.1.6. テーブル一覧](#116-テーブル一覧)
    - [1.1.7. ファイル一覧](#117-ファイル一覧)
    - [1.1.8. 在庫の定義](#118-在庫の定義)
  - [1.2. レイアウト](#12-レイアウト)
    - [1.2.1. 画面イメージ（現行）](#121-画面イメージ現行)
    - [1.2.2. 画面イメージ（再構築）](#122-画面イメージ再構築)
    - [1.2.3. 画面項目](#123-画面項目)
    - [1.2.4. イベント定義](#124-イベント定義)
  - [1.3. API](#13-api)
    - [1.3.1. API一覧](#131-api一覧)

## 1.1. 処理概要

### 1.1.1. 機能名

| No. | 項目 | 値 |
|:---:|:----------------:|:-------------------:|
| 1 | プロジェクト | meeth様ECサイト開発 |
| 2 | システム | 管理画面 |
| 3 | 画面プログラム | 商品詳細.在庫数 |
| 4 | 画面プログラムID | M5.4 |
| 5 | 画面フォーム名 | N/A |

### 1.1.2. 機能概要

- 在庫数情報を表示する
- 在庫数の追加をする

### 1.1.3. 前提条件

- ログイン済のユーザであること
- ログインユーザの[権限](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E6%A8%A9%E9%99%90%E4%B8%80%E8%A6%A7)が条件を満たしていること(総合管理者、作業担当者のみ閲覧・操作可能)

### 1.1.4. 処理概要

| No | 操作 | 処理概要 |
|----|----------------------------------------------------|----------------------------------------------------------------------------------------------------------|
| 1 | 初期表示時 | 在庫数情報が表示される |
| 2 | 追加ボタンを押下する | 在庫数が追加される<br>その際、追加履歴も表示される |

### 1.1.5. パラメータ一覧

| No | 論理名称 | 物理名称 | I/O | 備考 |
|----------------|----------|-----------|-----|------|
| 1 | 商品ID | product_id | O | |

### 1.1.6. テーブル一覧

| No | 論理名称 | 物理名称 | I/O | 備考 |
|----|------------------|-------------------|-----|------|
| 1 | [商品テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_products) | products | O | |
| 2 | [商品詳細テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_product_details) | product_details | O | |
| 3 | [商品在庫テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_product_stocks) | product_stocks | O | |
| 4 | [商品在庫履歴テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_product_stock_trails) | product_stock_trails | O | |

### 1.1.7. ファイル一覧

なし

### 1.1.8. 在庫の定義

| No   | 名称                        |　内容　|
|------|----------|-------------------|
| 1 | 倉庫の在庫数 | 在庫調整された在庫数-出荷済数 |
| 2 | 販売可能在庫数 | 倉庫の在庫数-引当数 |
| 3 | 引当数 | 注文を受付済みで未出荷の商品の数（出荷済、返品、キャンセル以外の注文） |

## 1.2. レイアウト

### 1.2.1. 画面イメージ（現行）

![image](https://user-images.githubusercontent.com/77314669/116343535-8db78800-a81f-11eb-85c0-7e551420e663.png)



### 1.2.2. 画面イメージ（再構築）
![image](https://user-images.githubusercontent.com/77314669/116343389-4af5b000-a81f-11eb-9227-329a11968a49.png)




### 1.2.3. 画面項目

| No   | 名称                        | 対応DB項目                                                     | I/O   | 種別     | 型       | 桁数   | 必須   | バリデーション | 備考               |
|------|-----------------------------|----------------------------------------------------------------|-------|----------|----------|--------|--------|----------------|--------------------|
| 1    | JANコード                   | ー                                                             | O     | ラベル   | ー       | ー     | ー     | ー             |                    |
|      |                             | product_details.jan_code                                       | O     | テキスト | ー       | ー     | ー     | ー             |                    |
| 2    | 現在の在庫数                | ー                                                             | O     | ラベル   | ー       | ー     | ー     | ー             |                    |
|      |                             | product_stocks.stock                                           | O     | テキスト | ー       | ー     | ー     | ー             |        倉庫の在庫数            |
| 3    | 現在の注文数                | ー                                                             | O     | ラベル   | ー       | ー     | ー     | ー             |                    |
|      |                             | product_detail.allocated_stock                                 | O     | テキスト | ー       | ー     | ー     | ー             |                    |
| 4    | 在庫数を追加                | ー                                                             | O     | ラベル   | ー       | ー     | ー     | ー             |       倉庫の在庫数             |
|      | - 追加フォーム              | product_stocks.stock                                           | I     | フォーム | ー       | ー     | ー     | ー             |                    |
| 5    | 追加                        | ー                                                             | O     | ボタン   | ー       | ー     | ー     | ー             | 在庫を即時追加する |
| 6    | 最終編集日                  | ー                                                             | O     | ラベル   | ー       | ー     | ー     | ー             |                    |
|      |                             | product_detail.product_stock.product_stock_trails.created_at   | O     | テキスト | ー       | ー     | ー     | ー             |                    |
| 7    | 追加前在庫数                | ー                                                             | O     | ラベル   | ー       | ー     | ー     | ー             |                    |
|      |                             | product_detail.product_stock.product_stock_trails.before_stock | O     | テキスト | ー       | ー     | ー     | ー             |                    |
| 8    | 追加後在庫数                | ー                                                             | O     | ラベル   | ー       | ー     | ー     | ー             |                    |
|      |                             | product_detail.product_stock.product_stock_trails.after_stock  | O     | テキスト | ー       | ー     | ー     | ー             |                    |

### 1.2.4. イベント定義

| No  | 項目           | 発生条件 | 遷移先 | 備考 | API |
| --- | -------------- | -------- | ------ | ---- | -- |
| 1   | 初期表示       | ー | ー       |      | 商品在庫数情報取得API<br>商品在庫数追加履歴取得API |
| 2   | 追加ボタン       | クリック | ー       |      | 商品在庫数追加API<br>商品在庫数追加履歴取得API |

## 1.3. API

### 1.3.1. API一覧

| NO. | 名称 | 内容 |
|-|-|-|
| 1 | 商品在庫数情報取得API | 商品在庫数情報を取得する |
| 2 | 商品在庫数追加履歴取得API | 商品在庫数追加履歴情報を取得する |
| 3 | 商品在庫数追加API | 商品在庫数を追加及び、商品在庫数追加履歴への追加処理を行う |
