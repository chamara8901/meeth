# 1. [管理画面再構築](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E7%94%BB%E9%9D%A2%E4%B8%80%E8%A6%A7%28ver2.0%29) - M6.2:顧客詳細 機能設計書


- [1. 管理画面再構築 - M6.2:顧客詳細 機能設計書](#1-管理画面再構築---m62顧客詳細-機能設計書)
  - [1.1. 処理概要](#11-処理概要)
    - [1.1.1. 機能名](#111-機能名)
    - [1.1.2. 機能概要](#112-機能概要)
    - [1.1.3. 前提条件](#113-前提条件)
    - [1.1.4. 処理概要](#114-処理概要)
    - [1.1.5. パラメータ一覧](#115-パラメータ一覧)
    - [1.1.6. テーブル一覧](#116-テーブル一覧)
    - [1.1.7. ファイル一覧](#117-ファイル一覧)
  - [1.2. レイアウト](#12-レイアウト)
    - [1.2.1. 画面イメージ（現行）](#121-画面イメージ現行)
    - [1.2.2. 画面イメージ（再構築）](#122-画面イメージ再構築)
    - [1.2.3. 画面項目](#123-画面項目)
    - [1.2.4. イベント定義](#124-イベント定義)
  - [1.3. API](#13-api)
    - [1.3.1. API一覧](#131-api一覧)


## 1.1. 処理概要

### 1.1.1. 機能名
|  No.  |       項目       |         値          |
| :---: | :--------------: | :-----------------: |
|   1   |   プロジェクト   | meeth様ECサイト開発 |
|   2   |     システム     |      管理画面       |
|   3   |  画面プログラム  |      顧客詳細       |
|   4   | 画面プログラムID |        M6.2         |
|   5   |  画面フォーム名  |         N/A         |

### 1.1.2. 機能概要

- 顧客詳細情報を表示する。
- タブ切り替えで注文一覧を表示する。
- タブ切り替えで定期購入一覧を表示する。
- タブ切り替えで入荷リクエスト一覧を表示する。
- タブ切り替えでお届け先一覧を表示する。

### 1.1.3. 前提条件

- ログイン済のユーザであること
- ログインユーザの[権限](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E6%A8%A9%E9%99%90%E4%B8%80%E8%A6%A7)が条件を満たしていること(総合管理者、許可された作業担当者のみ閲覧・操作可能)

### 1.1.4. 処理概要

| No  | 操作                                               | 処理概要                                             |
| --- | -------------------------------------------------- | ---------------------------------------------------- |
| 1   | 初期表示時                                         | 顧客検索画面にて選択された顧客の詳細情報を表示する。<br>注文一覧タブが押下された状態とする。 |
| 2   | 「注文一覧」タブ押下時                                 | 注文一覧を表示する。                                 |
| 3   | 「定期購入」タブ押下時                                 | 定期購入を表示する。                                 |
| 4   | 「入荷リクエスト」タブ押下時                           | 入荷リクエストを表示する。                           |
| 5   | 「お届け先」タブ押下時                               | お届け先を表示する。                                 |

### 1.1.5. パラメータ一覧

| No  | 論理名称 | 物理名称 | I/O | 備考 |
| --- | -------- | -------- | --- | ---- |
| 1   |     顧客ID     |    customer_id      |   O  |      |

### 1.1.6. テーブル一覧
| No  | 論理名称                                                                                                                                      | 物理名称              | I/O | 備考 |
| --- | --------------------------------------------------------------------------------------------------------------------------------------------- | --------------------- | --- | ---- |
| 1   | [顧客情報テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_customers)                    | customers             | O   |      |
| 2   | [顧客住所テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_customer_addresses)           | customer_addresses    | O   |      |
| 3   | [注文テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_orders)        | orders         | O   |      |

### 1.1.7. ファイル一覧

なし

## 1.2. レイアウト

### 1.2.1. [旧仕様](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-0062.M6.2:%E9%A1%A7%E5%AE%A2%E8%A9%B3%E7%B4%B0_ver1.0)

### 1.2.2. 画面イメージ

- 値はサンプルです
![image](https://user-images.githubusercontent.com/77314669/115186088-06ca2780-a11c-11eb-81b4-b15139aaa32c.png)


- 顧客詳細開閉
![image](https://user-images.githubusercontent.com/77314669/115186132-1ba6bb00-a11c-11eb-9307-2c8a7fe20c96.png)



### 1.2.3. 画面項目

| No    | 名称                    | 対応DB項目                                                                                | I/O   | 種別       | 型     | 桁数   | 必須   | 備考                                                                                                   |
|-------|-------------------------|-------------------------------------------------------------------------------------------|-------|------------|--------|--------|--------|--------------------------------------------------------------------------------------------------------|
| 1     | ページタイトル          | －                                                                                        | O     | ラベル     | －     | －     | －     |                                                                                                        |
| 2     | ユーザーID              | －                                                                                        | O     | ラベル     | －     | －     | －     |                                                                                                        |
| 3     | 編集                    | －                                                                                        | O     | ボタン     | －     | －     | －     |                                                                                                        |
| 4     | 顧客ID                  | －                                                                                        | O     | ラベル     | －     | －     | －     |                                                                                                        |
|       |                         | customer_addresses.customer_id                                                            | O     | テキスト   | －     | －     | －     |                                                                                                        |
| 5     | アカウント作成日        |                                                                                           | O     | ラベル     | －     | －     | －     |                                                                                                        |
|       |                         | customers.created_at                                                                      | O     | テキスト   | －     | －     | －     |                                                                                                        |
| 6     | メールアドレス          | －                                                                                        | O     | ラベル     | －     | －     | －     |                                                                                                        |
|       |                         | customer_addresses.email                                                                  | O     | テキスト   | －     | －     | －     |                                                                                                        |
| 7     | DM可否                  | －                                                                                        | O     | ラベル     | －     | －     | －     |                                                                                                        |
|       |                         | customer.dm_agreed                                                                        | O     | テキスト   | －     | －     | －     | 0= 拒否, 1=許可 と表示する                                                                             |
| 8     | 名前                    | －                                                                                        | O     | ラベル     | －     | －     | －     |                                                                                                        |
|       |                         | customer_addresses.family_name<br>customer_addresses.first_name                           | O     | テキスト   | －     | －     | －     |                                                                                                        |
| 9     | 誕生日                  | －                                                                                        | O     | ラベル     | －     | －     | －     |                                                                                                        |
|       |                         | customer.birthday                                                                         | O     | テキスト   | －     | －     | －     | yyyy/mm//ddで記載する<br>年齢を()内に表示する                                                          |
| 10    | 注文数（定期）          | －                                                                                        | O     | ラベル     | －     | －     | －     |                                                                                                        |
|       |                         | orders.customer_id<br> orders.subscription_id<br> orders.status                           | O     | テキスト   | －     | －     | －     | customer_id, subscription_idそれぞれに紐づくデータのうち、status=3の件数表示                           |
| 11    | 購入金額（定期）        | －                                                                                        | O     | ラベル     | －     | －     | －     |                                                                                                        |
|       |                         | orders.customer_id<br> orders.subscription_id<br> orders.status<br> orders.total_amount   | O     | テキスト   | －     | －     | －     | customer_id, subscription_idそれぞれに紐づくデータのうち、status=3のtotal_amountの合計を表示           |
| 12    | 初回注文日              |                                                                                           | O     | ラベル     | －     | －     | －     |                                                                                                        |
|       |                         | orders.created_at                                                                         | O     | テキスト   | －     | －     | －     | customer_idで取得した最も早いcreated_at<br> yyyy年mmヶ月dd日前で表記する                               |
| 13    | 最終注文日              |                                                                                           | O     | ラベル     | －     | －     | －     |                                                                                                        |
|       |                         | orders.created_at                                                                         | O     | テキスト   | －     | －     | －     | customer_idで取得した最も遅いcreated_at                                                                |
| 14    | ユーザー規制            | －                                                                                        | O     | テキスト   | －     | －     | －     | 表記のみ                                                                                               |
| 15    | 非表示/表示開閉ボタン   | －                                                                                        | O     | ボタン     | －     | －     | －     | 押下時に顧客ID,メールアドレス,DN可否,名前(姓),名前(名)以外の情報を非表示にする<br>再度押下で表示する   |

### 1.2.4. イベント定義

| No  | 項目           | 発生条件 | 遷移先 | 備考 | API |
| --- | -------------- | -------- | ------ | ---- |---- |
| 1   | 初期表示       | ー |    ー    |      | 詳細情報取得API |
| 2   | 注文一覧       | クリック |    [顧客詳細-注文一覧](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-0063.M6.3:%E9%A1%A7%E5%AE%A2%E8%A9%B3%E7%B4%B0.%E6%B3%A8%E6%96%87%E4%B8%80%E8%A6%A7_ver2.0)    |   タブ切り替え   | |
| 3   | 定期購入       | クリック |    [顧客詳細-定期購入](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-0064.M6.4:%E9%A1%A7%E5%AE%A2%E8%A9%B3%E7%B4%B0.%E5%AE%9A%E6%9C%9F%E8%B3%BC%E5%85%A5_ver2.0)    |   タブ切り替え   | |
| 4   | 入荷リクエスト | クリック |    [顧客詳細-入荷リクエスト](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-0065.M6.5:%E9%A1%A7%E5%AE%A2%E8%A9%B3%E7%B4%B0.%E5%85%A5%E8%8D%B7%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88_ver2.0)    |   タブ切り替え   | |
| 5   | お届け先       | クリック |    [顧客詳細-お届け先](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-0066.M6.6:%E9%A1%A7%E5%AE%A2%E8%A9%B3%E7%B4%B0.%E3%81%8A%E5%B1%8A%E3%81%91%E5%85%88_ver2.0)    |   タブ切り替え   | |
| 6   | 編集ボタン       | クリック |    [顧客詳細-編集](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-0067.M6.7:%E9%A1%A7%E5%AE%A2%E7%B7%A8%E9%9B%86_ver2.0)    |      | |

## 1.3. API

### 1.3.1. API一覧

| NO. | 名称                | 内容                     |
| --- | ------------------- | ------------------------ |
| 1   | [詳細情報取得API](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E9%A1%A7%E5%AE%A2%E8%A9%B3%E7%B4%B0-%E8%A9%B3%E7%B4%B0%E6%83%85%E5%A0%B1%E5%8F%96%E5%BE%97API) | 詳細情報を取得する |
