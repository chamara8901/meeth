# 1. [管理画面再構築](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E7%94%BB%E9%9D%A2%E4%B8%80%E8%A6%A7%28ver2.0%29) - M3.6:注文詳細.注文領収書 機能設計書

- [1. 管理画面再構築 - M3.6:注文詳細.注文領収書 機能設計書](#1-管理画面再構築---m36注文詳細注文領収書-機能設計書)
  - [1.1. 処理概要](#11-処理概要)
    - [1.1.1. 機能名](#111-機能名)
    - [1.1.2. 機能概要](#112-機能概要)
    - [1.1.3. 前提条件](#113-前提条件)
    - [1.1.4. 処理概要](#114-処理概要)
    - [1.1.5. パラメータ一覧](#115-パラメータ一覧)
    - [1.1.6. テーブル一覧](#116-テーブル一覧)
    - [1.1.7. ファイル一覧](#117-ファイル一覧)
  - [1.2. レイアウト](#12-レイアウト)
    - [1.2.1. 画面イメージ（現行）](#121-画面イメージ現行)
    - [1.2.2. 画面イメージ（再構築）](#122-画面イメージ再構築)
    - [1.2.3. 画面項目](#123-画面項目)
  - [1.3. API](#13-api)
    - [1.3.1. API一覧](#131-api一覧)

## 1.1. 処理概要

### 1.1.1. 機能名
| No. | 項目 | 値 |
|:---:|:----------------:|:-------------------:|
| 1 | プロジェクト | meeth様ECサイト開発 |
| 2 | システム | 管理画面 |
| 3 | 画面プログラム | 注文詳細.領収書 |
| 4 | 画面プログラムID | M3.6 |
| 5 | 画面フォーム名 | N/A |

### 1.1.2. 機能概要

- 注文の領収書を表示する。
  - ゆくゆくは、宛名と但し書きを編集出来るようにしたい要望あり
  - ゆくゆくは、注文時または注文後に領収書発行用のURLから顧客が自身で領収書発行可能な仕組みも検討
  - 領収書発行が管理者だと印紙が必要なこともあって、ユーザが発行出来る方が望ましい
- 原則１注文につき１回しか発行できない
  - ユーザ側、管理画面側含めて一回

### 1.1.3. 前提条件

- ログイン済のユーザであること
- ログインユーザの[権限](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E6%A8%A9%E9%99%90%E4%B8%80%E8%A6%A7)が条件を満たしていること(総合管理者、許可された作業担当者のみ閲覧・操作可能)

### 1.1.4. 処理概要
| No | 操作 | 処理概要 |
|----|----------------------------------------------------|----------------------------------------------------------------------------------------------------------|
| 1 | 初期表示時 | 注文の領収書が表示される |

### 1.1.5. パラメータ一覧

| No | 論理名称 | 物理名称 | I/O | 備考 |
|----------------|----------|-----------|-----|------|
| 1 | 注文ID | order_id | O  | |

### 1.1.6. テーブル一覧
| No | 論理名称 | 物理名称 | I/O | 備考 |
|----|------------------|-------------------|-----|------|
| 1 | [注文テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_orders) | orders | O | |


### 1.1.7. ファイル一覧

| No | 論理名称 | 物理名称 | I/O | 備考 |
|----------------|----------|-----------|-----|------|
| 1 | 領収書 | receipt | O | |

## 1.2. レイアウト
### 1.2.1. 画面イメージ（現行）



### 1.2.2. 画面イメージ（再構築）

![image](https://user-images.githubusercontent.com/77314669/115697309-69caf100-a39e-11eb-8008-b3a3f27aad68.png)




### 1.2.3. 画面項目

| No   | 名称                        | 対応DB項目                                                  | I/O   | 種別     | 型       | 桁数   | 必須   | バリデーション | 備考                                           |
|------|-----------------------------|-------------------------------------------------------------|-------|----------|----------|--------|--------|----------------|------------------------------------------------|
| 1    | No.                         | ー                                                          | O     | ラベル   | ー       | ー     | ー     | ー             |                                                |
|      |                             | orders.id                                                   | O     | テキスト | ー       | ー     | ー     | ー             |                                                |
| 2    | 発行日：                    | ー                                                          | O     | リンク   | ー       | ー     | ー     | ー             |                                                |
|      |                             | orders.created_at                                                          | O     | テキスト | ー       | ー     | ー     | ー             | 注文日を表示                               |
| 3    | 領収書<br>Recelpt           | ー                                                          | O     | ラベル   | ー       | ー     | ー     | ー             |                                                |
| 4    | 様                          | ー                                                          | O     | テキスト | ー       | ー     | ー     | ー             | ※現状特定の名前は入らない仕様                   |
| 5    | 合計金額                    | ー                                                          | O     | ラベル   | ー       | ー     | ー     | ー             |                                                |
|      |                             | orders.total_amount<br>orders_detail.tax_rate<br>orders.fee | O     | テキスト | ー       | ー     | ー     | ー             | プログラムにて計算                             |
|      |                             | （税込）                                                    | O     | ラベル   | ー       | ー     | ー     | ー             |                                                |
| 6    | 但し書き                    | ー                                                          | O     | テキスト | ー       | ー     | ー     | ー             | ※現状は「但しお品代として上記の金額正に領収いたしました」がベタ書き |
| 7    | 内訳                        | ー                                                          | O     | ラベル   | ー       | ー     | ー     | ー             |                                                |
|      | 税抜金額                    | ー                                                          | O     | ラベル   | ー       | ー     | ー     | ー             |                                                |
|      |                             | orders.total_amount                                         | O     | テキスト | ー       | ー     | ー     | ー             |                                                |
| 8    | 配送料                      | ー                                                          | O     | ラベル   | ー       | ー     | ー     | ー             |                                                |
|      |                             | orders.fee                                                  | O     | テキスト | ー       | ー     | ー     | ー             |                                                |
| 9    | 消費税等                    | ー                                                          | O     | ラベル   | ー       | ー     | ー     | ー             |                                                |
|      |                             | orders_detail.tax_rate                                      | O     | テキスト | ー       | ー     | ー     | ー             |                                                |
| 10   | ロゴ                        | ー                                                          | O     | 画像     | ー       | ー     | ー     | ー             |                                                |
| 11   | 会社住所                    | ー                                                          | O     | テキスト | ー       | ー     | ー     | ー             |                                                |
| 12   | 会社印                      | ー                                                          | O     | 画像     | ー       | ー     | ー     | ー             |                                                |

### 1.2.4. イベント定義

| No  | 項目           | 発生条件 | 遷移先 | 備考 | API |
| --- | -------------- | -------- | ------ | ---- | -- |
| 1   | 初期表示       | ー |    ー   |      | 領収書情報取得API    |

## 1.3. API

### 1.3.1. API一覧
| NO. | 名称 | 内容 |
|-|-|-|
| 1 | 領収書情報取得API | 領収書生成に必要な情報を取得する |
