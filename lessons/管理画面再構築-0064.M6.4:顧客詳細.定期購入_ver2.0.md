# 1. [管理画面再構築](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E7%94%BB%E9%9D%A2%E4%B8%80%E8%A6%A7%28ver2.0%29) - M6.4:顧客詳細:定期購入 機能設計書


- [1. 管理画面再構築 - M6.4:顧客詳細:定期購入 機能設計書](#1-管理画面再構築---m64顧客詳細定期購入-機能設計書)
  - [1.1. 処理概要](#11-処理概要)
    - [1.1.1. 機能名](#111-機能名)
    - [1.1.2. 機能概要](#112-機能概要)
    - [1.1.3. 前提条件](#113-前提条件)
    - [1.1.4. 処理概要](#114-処理概要)
    - [1.1.5. パラメータ一覧](#115-パラメータ一覧)
    - [1.1.6. テーブル一覧](#116-テーブル一覧)
    - [1.1.7. ファイル一覧](#117-ファイル一覧)
  - [1.2. レイアウト](#12-レイアウト)
    - [1.2.1. 画面イメージ（現行）](#121-画面イメージ現行)
    - [1.2.2. 画面イメージ（再構築）](#122-画面イメージ再構築)
    - [1.2.3. 画面項目](#123-画面項目)
    - [1.2.4. イベント定義](#124-イベント定義)
  - [1.3. API](#13-api)
    - [1.3.1. API一覧](#131-api一覧)

## 1.1. 処理概要

### 1.1.1. 機能名

|  No.  |       項目       |         値          |
| :---: | :--------------: | :-----------------: |
|   1   |   プロジェクト   | meeth様ECサイト開発 |
|   2   |     システム     |      管理画面       |
|   3   |  画面プログラム  |      顧客詳細       |
|   4   | 画面プログラムID |        M6.4         |
|   5   |  画面フォーム名  |         N/A         |

### 1.1.2. 機能概要

- 顧客詳細情報を表示する。
- 定期購入一覧を表示する。
 - 定期購入詳細画面に遷移する。

### 1.1.3. 前提条件

- ログイン済のユーザであること
- ログインユーザの[権限](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E6%A8%A9%E9%99%90%E4%B8%80%E8%A6%A7)が条件を満たしていること(総合管理者、許可された作業担当者のみ閲覧・操作可能)

### 1.1.4. 処理概要

| No  | 操作                                               | 処理概要                     |
| --- | -------------------------------------------------- | ---------------------------- |
| 1   | 「定期購入」押下時                                 | 定期購入一覧を表示する。         |
| 3   | 定期購入ID押下時 | 当該定期購入詳細画面に遷移する。 |

### 1.1.5. パラメータ一覧

| No  | 論理名称 | 物理名称 | I/O | 備考 |
| --- | -------- | -------- | --- | ---- |
| 1   |     顧客ID     |    customer_id      |   O  |      |

### 1.1.6. テーブル一覧
| No  | 論理名称                                                                                                                                      | 物理名称              | I/O | 備考 |
| --- | --------------------------------------------------------------------------------------------------------------------------------------------- | --------------------- | --- | ---- |
| 1   | [顧客情報テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_customers)                    | customers             | O   |      |
| 2   | [定期購入基本情報テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_subscriptions)           | subscriptions    | O   |      |
| 3   | [定期購入詳細テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_subscription_details)        | subscription_details         | O   |      |
| 4   | [商品テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_products)        | subscription_details         | O   |      |
| 5   | [商品詳細テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_product_details)        | subscription_details         | O   |      |

### 1.1.7. ファイル一覧

なし

## 1.2. レイアウト

### 1.2.1. 画面イメージ（現行）

![image](https://user-images.githubusercontent.com/77314669/113736635-3b131080-9738-11eb-8d13-5b16fbaa2811.png)

### 1.2.2. 画面イメージ（再構築）

![image](https://user-images.githubusercontent.com/77314669/115186845-59581380-a11d-11eb-91d6-b23ee55b7993.png)




### 1.2.3. 画面項目

| No  | 名称           | 対応DB項目                                                                                                    | I/O | 種別     | 型 | 桁数 | 必須 | バリデーション | 備考                                                                                                          |
|-----|----------------|---------------------------------------------------------------------------------------------------------------|-----|----------|----|------|------|----------------|---------------------------------------------------------------------------------------------------------------|
| 1   | 定期購入タブ   | ー                                                                                                            | O   | タブ     | ー | ー   | ー   | ー             |                                                                                                               |
| 2   | ページャー     | ー                                                                                                            | O   | リンク   | ー | ー   | ー   | ー             |                                                                                                               |
| 3   | 件数表示       | ー                                                                                                            | O   | テキスト | ー | ー   | ー   | ー             |                                                                                                               |
| 4   | 定期購入ID     | ー                                                                                                            | O   | ラベル   | ー | ー   | ー   | ー             |                                                                                                               |
|     |                | subscriptions.id                                                                                              | O   | リンク   | ー | ー   | ー   | ー             | 押下時に当該定期購入詳細画面へ遷移する                                                                        |
| 5   | 注文商品       | ー                                                                                                            | O   | ラベル   | ー | ー   | ー   | ー             |                                                                                                               |
|     |   - 商品名             | subscription_detail.order_id<br>orders_detail.product_detail_id<br>product_detail.product_id.<br>product.name |  O   | テキスト          |  ー  | ー     | ー     |    ー            | 複数ある場合は改行して複数表示                                                                                |
|     |  - 数量              | subscription_detail.quantity |  O   | テキスト          |  ー  | ー     | ー     |    ー            |                                                                                 |
| 6   | 請求金額       | ー                                                                                                            | O   | ラベル   | ー | ー   | ー   | ー             |                                                                                                               |
|     |                | subscription_detail.product_price.selling_price * subscription_detail.quantity<br>(orders.price * orders.tax_rate(customer_addresses.country)).round<br>shippingRate.overseas.price                                | O   | テキスト | ー | ー   | ー   | ー             |       実際に支払う金額を表示する                                                                                                        |
| 7   | 毎月のご注文日 | ー                                                                                                            | O   | ラベル   | ー | ー   | ー   | ー             |                                                                                                               |
|     |                | subscriptions.delivery_plan                                                                                   | O   | テキスト | ー | ー   | ー   | ー             |                                                                                                               |
| 8   | 注文回数       | ー                                                                                                            | O   | ラベル   | ー | ー   | ー   | ー             |                                                                                                               |
|     |                | count(subscriptions.customer_id)                                                                              | O   | テキスト | ー | ー   | ー   | ー             |                                                                                                               |
| 9   | 注文状況       | ー                                                                                                            | O   | ラベル   | ー | ー   | ー   | ー             |                                                                                                               |
|     |                | subscriptions.processing_status                                                                               | O   | テキスト | ー | ー   | ー   | ー             | 処理中は緑<br> 次回準備中はオレンジ<br> 一時停止は赤<br> それ以外はグレーのアイコンを状況の前につけて表示する |
| 10  | 購入日         | ー                                                                                                            | O   | ラベル   | ー | ー   | ー   | ー             |                                                                                                               |
|     |                | subscriptions.created_at                                                                                      | O   | テキスト | ー | ー   | ー   | ー             |                                                                                                               |

### 1.2.4. イベント定義

| No  | 項目           | 発生条件 | 遷移先 | 備考 | API |
| --- | -------------- | -------- | ------ | ---- | -- |
| 1   | 初期表示       | ー | ー       |      | 顧客詳細情報取得API　|
| 2   | 定期購入ID       | クリック | [定期購入詳細画面](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-0042.M4.2:%E5%AE%9A%E6%9C%9F%E8%B3%BC%E5%85%A5%E8%A9%B3%E7%B4%B0_ver2.0)       |      | |

## 1.3. API

### 1.3.1. API一覧

| NO. | 名称                | 内容                     |
| --- | ------------------- | ------------------------ |
| 1   | 顧客詳細情報取得API | 顧客の詳細情報を取得する |
