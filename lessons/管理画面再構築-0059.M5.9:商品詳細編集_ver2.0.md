# 1. [管理画面再構築](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E7%94%BB%E9%9D%A2%E4%B8%80%E8%A6%A7%28ver2.0%29) - M5.9:商品詳細編集 機能設計書

- [1. 管理画面再構築 - M5.9:商品詳細編集 機能設計書](#1-管理画面再構築---m59商品詳細編集-機能設計書)
  - [1.1. 処理概要](#11-処理概要)
    - [1.1.1. 機能名](#111-機能名)
    - [1.1.2. 機能概要](#112-機能概要)
    - [1.1.3. 前提条件](#113-前提条件)
    - [1.1.4. 処理概要](#114-処理概要)
    - [1.1.5. パラメータ一覧](#115-パラメータ一覧)
    - [1.1.6. テーブル一覧](#116-テーブル一覧)
    - [1.1.7. ファイル一覧](#117-ファイル一覧)
  - [1.2. レイアウト](#12-レイアウト)
    - [1.2.1. 画面イメージ（現行）](#121-画面イメージ現行)
    - [1.2.2. 画面イメージ（再構築）](#122-画面イメージ再構築)
    - [1.2.3. 画面項目](#123-画面項目)
    - [1.2.4. イベント定義](#124-イベント定義)
  - [1.3. API](#13-api)
    - [1.3.1. API一覧](#131-api一覧)

## 1.1. 処理概要

### 1.1.1. 機能名
| No. | 項目 | 値 |
|:---:|:----------------:|:-------------------:|
| 1 | プロジェクト | meeth様ECサイト開発 |
| 2 | システム | 管理画面 |
| 3 | 画面プログラム | 商品詳細編集 |
| 4 | 画面プログラムID | M5.9 |
| 5 | 画面フォーム名 | N/A |

### 1.1.2. 機能概要

- 商品詳細情報を編集する
  - JANコード、商品画像(追加・削除)、動画URL、動画扉絵、販売開始日、販売終了日、定価、ステータス、定期購入フラグ、最大購入数

### 1.1.3. 前提条件

- ログイン済のユーザであること
- ログインユーザの[権限](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E6%A8%A9%E9%99%90%E4%B8%80%E8%A6%A7)が条件を満たしていること(総合管理者、許可された作業担当者のみ閲覧・操作可能)

### 1.1.4. 処理概要

| No | 操作 | 処理概要 |
|----|----------------------------------------------------|----------------------------------------------------------------------------------------------------------|
| 1 | 初期表示時 | 商品詳細編集フォームが表示される |
| 2 | ファイルを選択ボタンを押下 | 画像がアップロードされる |
| 3 | 保存ボタンを押下 | 商品詳細情報が更新される |

### 1.1.5. パラメータ一覧

| No | 論理名称 | 物理名称 | I/O | 備考 |
|----------------|----------|-----------|-----|------|
| 1 | 商品詳細ID | product_detail_id | | |

### 1.1.6. テーブル一覧

| No | 論理名称 | 物理名称 | I/O | 備考 |
|----|------------------|-------------------|-----|------|
| 1 | [商品情報テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_products) | products | O | |
| 2 | [商品詳細テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_product_details) | product_details | O | |

### 1.1.7. ファイル一覧

なし

## 1.2. レイアウト
### 1.2.1. 画面イメージ（現行）
![image](https://user-images.githubusercontent.com/77314669/114053113-9de7e180-98c9-11eb-90b4-f5870a600214.png)


### 1.2.2. 画面イメージ（再構築）
![image](https://user-images.githubusercontent.com/77314669/114053435-eacbb800-98c9-11eb-9bad-45ad60951cb4.png)


### 1.2.3. 画面項目

| No | 名称             | 対応DB項目                                         | I/O | 種別               | 型                | 桁数 | 必須(YES/NO) | バリデーション | 備考                                                                                                                                                                                                                           |
|----|------------------|----------------------------------------------------|-----|--------------------|-------------------|------|--------------|----------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1  | 商品名           | ー                                                 | O   | ラベル             | ー                | ー   | ー           | ー             |                                                                                                                                                                                                                                |
|    |                  | products.name                                      | O   | テキスト           | ー                | ー   | ー           | ー             |                                                                                                                                                                                                                                |
| 2  | JANコード        | ー                                                 | O   | ラベル             | ー                | ー   | ー           | ー             |                                                                                                                                                                                                                                |
|    |                  | product_details.jan_code                           | I   | テキストフォーム   | string            |  255 | NO           | 桁数制限       |                                                                                                                                                                                                                                |
| 3  | 商品画像         | ー                                                 | O   | ラベル             | ー                | ー   | ー           | ー             |                                                                                                                                                                                                                                |
|    |                  | ー                                                 | O   | 画像               | ー                | ー   | ー           | ー             | ActiveRecord                                                                                                                                                                                                                   |
|    | - ファイルを選択 | (active_storage_blobs, active_storage_attachments) | I   | ボタン             | ー                | ー   | NO           | ー             | 画像をアップロードする<br>Active Storageにより設定                                                                                                                                                                             |
| 4  | - 削除する       | ー                                                 | O   | ラベル             | ー                | ー   | ー           | ー             |                                                                                                                                                                                                                                |
|    |                  | (active_storage_blobs, active_storage_attachments) | I   | チェックボックス   | ー                | ー   | NO           | ー             | 画像ごとに削除可能                                                                                                                                                                                                             |
| 5  | 動画URL          | ー                                                 | O   | ラベル             | ー                | ー   | ー           | ー             |                                                                                                                                                                                                                                |
|    |                  | product_details.movie_url                          | I   | テキストフォーム   | string            |   11 | NO           | 桁数制限       | プレースホルダは「URLの末尾11桁のID(ex:O0A5YSczs24)」                                                                                                                                                                          |
| 6  | 動画扉絵         | ー                                                 | O   | ラベル             | ー                | ー   | ー           | ー             |                                                                                                                                                                                                                                |
|    | - ファイルを選択 | product_details.movie_image                        | I   | ボタン             | ー                | ー   | NO           | ー             |                                                                                                                                                                                                                                |
| 7  | 販売開始日       | ー                                                 | O   | ラベル             | ー                | ー   | ー           | ー             |                                                                                                                                                                                                                                |
|    |                  | product_details.selling_start_at                   | I   | カレンダーアイコン | ー            | ー   | YES          | 必須           | カレンダーアイコン押下でカレンダーがポップアップ表示され、カレンダー内の日付を選択することでフォーム部分に日付が反映される<br> フォーム部分に直接入力は不可だが、反映された日付の削除は可能とする                              |
| 8  | 販売終了日       | ー                                                 | O   | ラベル             | ー                | ー   | ー           | ー             |                                                                                                                                                                                                                                |
|    |                  | product_details.selling_end_at                     | I   | カレンダーアイコン | ー            | ー   | NO           | ー             | ※現行は必須だが必須を外す<br>カレンダーアイコン押下でカレンダーがポップアップ表示され、カレンダー内の日付を選択することでフォーム部分に日付が反映される<br> フォーム部分に直接入力は不可だが、反映された日付の削除は可能とする |
| 9  | 定価             | ー                                                 | O   | ラベル             | ー                | ー   | ー           | ー             |                                                                                                                                                                                                                                |
|    |                  | product_details.fixed_price                        | I   | テキストフォーム   | integer<br>number | ー   | YES          | 必須<br>自然数 |                                                                                                                                                                                                                                |
| 10 | ステータス       | ー                                                 | O   | ラベル             | ー                | ー   | ー           | ー             |                                                                                                                                                                                                                                |
|    |                  | product_details.status                             | I   | プルダウン         | ー                | ー   | YES          | 必須           | 【下書き, 公開中, 公開終了】より選択                                                                                                                                                                                           |
| 11 | 引当数           | ー                                                 | O   | ラベル             | ー                | ー   | ー           | ー             |                                                                                                                                                                                                                                |
|    |                  | product_details.allocated_stock                    | O   | テキスト           | ー                | ー   | ー           | ー             |                                                                                                                                                                                                                                |
| 12 | 定期購入         | ー                                                 | O   | ラベル             | ー                | ー   | ー           | ー             |                                                                                                                                                                                                                                |
|    |                  | product_details.subscription                       | I   | チェックボックス   | ー                | ー   | NO           | ー             |                                                                                                                                                                                                                                |
| 13 | 最大購入数       | ー                                                 | O   | ラベル             | ー                | ー   | ー           | ー             |                                                                                                                                                                                                                                |
|    |                  | product_details.maximum_number_of_purchases        | I   | テキストフォーム   | integer<br>number | ー   | YES          | 必須<br>自然数 |                                                                                                                                                                                                                                |
| 14 | 保存             | ー                                                 | O   | ボタン             | ー                | ー   | ー           | ー             |                                                                                                                                                                                                                                |

### 1.2.4. イベント定義

| No  | 項目           | 発生条件 | 遷移先 | 備考 | API |
| --- | -------------- | -------- | ------ | ---- | -- |
| 1   | 保存ボタン       | クリック | [商品詳細画面](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-0053.M5.3:%E5%95%86%E5%93%81%E8%A9%B3%E7%B4%B0_ver2.0)       |      | 商品詳細情報更新API |

## 1.3. API

### 1.3.1. API一覧
| NO. | 名称 | 内容 |
|-|-|-|
| 1 | 商品詳細情報更新API | 商品詳細情報を更新するAPI |