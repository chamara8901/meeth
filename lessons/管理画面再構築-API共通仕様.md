# 1. [管理画面再構築](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E7%94%BB%E9%9D%A2%E4%B8%80%E8%A6%A7) - API共通仕様

- [1. 管理画面再構築 - API共通仕様](#1-管理画面再構築---api共通仕様)
  - [1.1. 共通レスポンスパラメータ](#11-共通レスポンスパラメータ)
    - [1.1.1 共通項目](#111-共通項目)
    - [1.1.2 status](#112-status)
    - [1.1.2.1 概要](#1121-概要)
    - [1.1.2.2 パラメータ値の内容](#1122-パラメータ値の内容)
    - [1.1.3 エラーコード及びメッセージ](#113-エラーコード及びメッセージ)
    - [1.1.3.1 概要](#1131-概要)
    - [1.1.3.2 パラメータ値の内容](#1132-パラメータ値の内容)
  - [1.2. アクセストークンとレダイレクトトークン](#12-アクセストークンとレダイレクトトークン)
    - [1.2.1 概要](#121-概要)
    - [1.2.2 リクエストパラメータ](#122-リクエストパラメータ)
    - [1.2.3 レスポンスパラメータ](#123-レスポンスパラメータ)

## 1.1. 共通レスポンスパラメータ

### 1.1.1 共通項目

| NO  | パラメータ名 | パラメータ名 | 値(例)          | 説明                                 |
| --- | ------------ | ------------ | --------------- | ------------------------------------ |
| 1   | 処理結果     | result       | array           | 結果の連想配列(JSONのオブジェクト型) |
| 1-1 | ステータス   | status       | string(success) | ステータス                           |
| 1-2 | コード       | code         | integer(0)      | エラー原因を特定するコード番号       |
| 1-3 | メッセージ   | message      | string(正常)    | エラーメッセージ                     |

### 1.1.2 status

### 1.1.2.1 概要

| NO  | 名称   | 内容                     |
| --- | ------ | ------------------------ |
| 1   | status | ステータス結果を格納する |

### 1.1.2.2 パラメータ値の内容

| NO  | status | 返却内容説明                                                                                          | 備考 |
| --- | ---------- | ----------------------------------------------------------------------------------------------------- | ---- |
| 1   | success    | dataパラメータに想定される結果を格納して返却する                                                      |      |
| 2   | error      | 同時に「code」にエラー原因を特定するコード番号、「message」にエラーメッセージを格納する               |      |
| 3   | redirect   | 同時に「code」に要リダイレクト(要再認証)原因を特定するコード、「message」にエラーメッセージを格納する |      |

### 1.1.3 エラーコード及びメッセージ

### 1.1.3.1 概要

| NO  | 名称 | 内容                                                                   |
| --- | ---- | ---------------------------------------------------------------------- |
| 1   | code | エラー時や要リダイレクト時に、エラー原因を特定するコード番号を格納する |
| 2   | message | エラー時や要リダイレクト時に、エラー原因を特定するエラーメッセージを格納する |

### 1.1.3.2 パラメータ値の内容

| NO | Code   | Message                                                                   | エラーケース                                                                  |
|----|--------|---------------------------------------------------------------------------|-------------------------------------------------------------------------------|
| 1  | 0      | 正常                                                                      | 正常時レスポンス                                                              |
| 2  | 000001 | 存在しないパス[xxxxx]にアクセスしました。                                 | 存在しないパスへアクセスした場合                                              |
| 3  | 000002 | アクセス元ホストのURIスキームがhttpsではありません                        | https以外でアクセスした場合                                                   |
| 4  | 001001 | access_tokenが指定されていません。                                        | access_tokenがパラメータに指定されていない場合                                |
| 5  | 001002 | access_token[xxxxx]が不正です。                                           | 不正なaccess_tokenがパラメータに指定されている場合                            |
| 6  | 001003 | access_tokenの有効期限が終了しました。                                    | access_tokenが有効期限切れの場合(refresh_token未設定時)                       |
| 7  | 002000 | 入力エラーが存在します。[バリデーションエラー内容]                        | バリデーションエラーの場合<br>内容はエラー内容によって異なる                  |
| 8  | 002001 | ログインできませんでした。[ログイン時エラー内容]                          | バリデーションエラー以外でログイン処理に失敗した場合                          |
| 9  | 002002 | 閲覧・操作権限エラーです。                                                | ログイン権限エラーの場合                                                      |
| 10 | 002003 | 保存処理に失敗しました。                                                  | 新規登録・更新処理に失敗した場合                                              |
| 11 | 002004 | 削除に失敗しました。                                                      | 削除処理に失敗した場合                                                        |
| 12 | 002005 | CSVダウンロード処理に失敗しました。                                       | CSVダウンロード処理に失敗した場合                                             |
| 13 | 003001 | SQLのタイムアウトエラーです。                                             | SQLの実行時間が長過ぎる場合                                                   |
| 14 | 003002 | 現在[xxxxx]がメンテナンス中の為、再度時間を置いてからアクセスして下さい。 | サービスがメンテナンス中の場合<br>[xxxxx]にはメンテナンスサービス名を格納する |
| 15 | 999999 | APIサーバーのシステムエラーが発生しました。                               | 例外を捕捉した場合                                                            |

## 1.2. アクセストークンとレダイレクトトークン

### 1.2.1 概要

| NO | 名称 | 内容                                                                   |
|----| ---- | ---------------------------------------------------------------------- |
| 1   | access_token | メイン機能のデータにアクセスする為のログイントークン |
| 2   | access_token_limit | access_tokenの有効期限 |
| 3   | refresh_token | access_tokenの有効期限が切れた際に、access_tokenを再発行する為のトークン |
| 4   | refresh_token_limit | refresh_tokenの有効期限 |

### 1.2.2 リクエストパラメータ
- 必ずHeader部分にaccess_tokenとrefresh_tokenを格納する。
- body部分に各々のAPIで必要なリクエストを格納する。


| NO  | パラメータ名         | パラメータ名  | 値(例)                                                       | 説明                                                                                                                                                                                                                            |
| --- | -------------------- | ------------- | ------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1   | ヘッダ               | header        |                                                              | ヘッダ部分に格納するもの                                                                                                                                                                                                        |
| 1-1 | アクセストークン     | access_token  | in:header schema:string(185795123454345fdfgeg) required:true | access_token                                                                                                                                                                                                                    |
| 1-2 | リフレッシュトークン | refresh_token | in:header schema:string(185795123454345fdfgeg)               | 【refresh_tokenの値があり、access_tokenの有効期限が切れた場合】 access_tokenとrefresh_tokenが新しい値に更新される  【refresh_tokenの値がなく、access_tokenの有効期限が切れた場合】 レスポンスのresultの値がredirectで返却される |

### 1.2.3 レスポンスパラメータ
-必ずaccess_token、access_token_limitとrefresh_token、refresh_token_limitを返却する。

| NO   | パラメータ名                           | パラメータ名                   | 値(例)                      | 説明                                                                       |
| ---- | -------------------------------------- | ------------------------------ | --------------------------- | -------------------------------------------------------------------------- |
| 1  | アクセストークン                       | access_token                   | string(xxxx)                | 入力パラメータで指定したaccess_tokenまたは、新たに発行されたaccess_token   |
| 2  | アクセストークンの有効期限切れ日時     | access_token_limit             | string(2022-12-01 12:00:00) | アクセストークンの有効期限切れ日時                                         |
| 3  | リフレッシュトークン                   | refresh_token                  | string(xxxx)                | 入力パラメータで指定したrefresh_tokenまたは、新たに発行されたrefresh_token |
| 4  | リフレッシュトークンの有効期限切れ日時 | refresh_token_limit            | string(2022-12-01 12:00:00) | リフレッシュトークンの有効期限切れ日時                                     |

- レスポンス例
```json
{
 "result":{
   "status":"success"
   "code":0
   "message":"正常"
 }
 "data":{
 }
 "access_token":"xxxx"
 "access_token_limit":"2022-12-01 12:00:00"
 "refresh_token":"xxxx"
 "refresh_token_limit":"2022-12-01 12:00:00"
}
```