# 1. [管理画面再構築](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E7%94%BB%E9%9D%A2%E4%B8%80%E8%A6%A7%28ver2.0%29) - M3.4:注文詳細.注文キャンセル・保留／解除 機能設計書

- [1. 管理画面再構築 - M3.4:注文詳細.注文キャンセル・保留/解除 機能設計書](#1-管理画面再構築---m34注文詳細注文キャンセル保留解除-機能設計書)
  - [1.1. 処理概要](#11-処理概要)
    - [1.1.1. 機能名](#111-機能名)
    - [1.1.2. 機能概要](#112-機能概要)
    - [1.1.3. 前提条件](#113-前提条件)
    - [1.1.4. 処理概要](#114-処理概要)
    - [1.1.5. パラメータ一覧](#115-パラメータ一覧)
    - [1.1.6. テーブル一覧](#116-テーブル一覧)
    - [1.1.7. ファイル一覧](#117-ファイル一覧)
  - [1.2. レイアウト](#12-レイアウト)
    - [1.2.1. 画面イメージ（現行）](#121-画面イメージ現行)
    - [1.2.2-1. 画面イメージ（再構築）(注文キャンセル)](#122-1-画面イメージ再構築注文キャンセル)
    - [1.2.2-2. 画面イメージ（再構築）(保留/解除)](#122-2-画面イメージ再構築保留解除)
    - [1.2.3. 画面項目](#123-画面項目)
    - [1.2.4. イベント定義](#124-イベント定義)
  - [1.3. API](#13-api)
    - [1.3.1. API一覧](#131-api一覧)

## 1.1. 処理概要

### 1.1.1. 機能名
| No. | 項目 | 値 |
|:---:|:----------------:|:-------------------:|
| 1 | プロジェクト | meeth様ECサイト開発 |
| 2 | システム | 管理画面 |
| 3 | 画面プログラム | 注文詳細 |
| 4 | 画面プログラムID | M3.4 |
| 5 | 画面フォーム名 | N/A |

### 1.1.2. 機能概要

- 注文キャンセルボタン押下で注文キャンセルモーダルを表示する
- 保留／解除ボタン押下で保留状態を変更するモーダルを表示する
　- 現在保留中では無い場合、保留変更モーダルを表示する
　- 現在保留中の場合、保留解除モーダルを表示する

### 1.1.3. 前提条件

- ログイン済のユーザであること
- ログインユーザの[権限](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-%E6%A8%A9%E9%99%90%E4%B8%80%E8%A6%A7)が条件を満たしていること(総合管理者、許可された作業担当者のみ閲覧・操作可能)

### 1.1.4. 処理概要
| No | 操作 | 処理概要 |
|----|----------------------------------------------------|----------------------------------------------------------------------------------------------------------|
| 1 | 初期表示時 | 注文詳細が表示される |
| 2 | 注文キャンセルボタン押下 | 注文キャンセルモーダルを表示する |
| 3 | 保留/解除ボタン押下 | 保留変更モーダルまたは保留解除モーダルを表示する |

### 1.1.5. パラメータ一覧

| No | 論理名称 | 物理名称 | I/O | 備考 |
|----------------|----------|-----------|-----|------|
| 1 | 注文ID | order_id | O  | |

### 1.1.6. テーブル一覧
| No | 論理名称 | 物理名称 | I/O | 備考 |
|----|------------------|-------------------|-----|------|
| 1 | [注文テーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_orders) | orders | O | |
| 2 | [注文キャンセルテーブル](https://github.com/grrowjp/Meeth/wiki/%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9_order_cancels) | order_cancels | O | |

### 1.1.7. ファイル一覧

なし

## 1.2. レイアウト

### 1.2.1. 画面イメージ（現行）

### 1.2.2-1. 画面イメージ（再構築）(注文キャンセル)

![image](https://user-images.githubusercontent.com/77314669/115698073-30df4c00-a39f-11eb-9437-67c568f5ca42.png)



&dArr;
![image](https://user-images.githubusercontent.com/77314669/115698145-43f21c00-a39f-11eb-8b1c-8b15332d55fe.png)

&dArr;

![image](https://user-images.githubusercontent.com/77314669/115698195-50767480-a39f-11eb-9f03-5420c4a63935.png)


### 1.2.2-2. 画面イメージ（再構築）(保留/解除)

![image](https://user-images.githubusercontent.com/77314669/115698311-71d76080-a39f-11eb-99b0-98dba1990781.png)


&dArr;
![image](https://user-images.githubusercontent.com/77314669/115698382-7f8ce600-a39f-11eb-8523-6acd42ddb57e.png)


&dArr;
![image](https://user-images.githubusercontent.com/77314669/115698425-8e739880-a39f-11eb-87dd-1afa1da9abee.png)



&dArr;
![image](https://user-images.githubusercontent.com/77314669/115698467-9c291e00-a39f-11eb-80db-f66155f18d61.png)


&dArr;
![image](https://user-images.githubusercontent.com/77314669/115698508-a814e000-a39f-11eb-9bb3-3010e1bc5999.png)




### 1.2.3. 画面項目

| No    | 名称                                 | 対応DB項目                                                                                | I/O   | 種別           | 型     | 桁数   | 必須   | 備考                                                                                                                                                            |
|-------|--------------------------------------|-------------------------------------------------------------------------------------------|-------|----------------|--------|--------|--------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1     | 注文キャンセル                       | －                                                                                        | O     | ボタン         | －     | －     | －     | 注文キャンセルモーダルを表示する                                                                                                                                |
| 2     | キャンセル理由を選択                 | －                                                                                        | O     | ラベル         | －     | －     | －     |                                                                                                                                                                 |
| 3     | (キャンセル理由のラジオボタン)       | payments.status<br>payments.payment_method                                                | I     | ラジオボタン   | －     | －     | －     | 【返品、発送前キャンセル、そのほか】から選択させる<br> なお、<br>銀行振込で振込待ちの場合は「銀行振込期限切れ」<br>代引きの場合は「代引拒否」を選択肢に追加する |
| 4     | (キャンセル理由のメモ)               | order_cancels.reason                                                                      | I     | テキストエリア | －     | －     | －     | プレースホルダは「メモを記載」                                                                                                                                  |
| 5     | 注文キャンセルを確定                 | －                                                                                        | O     | ボタン         | －     | －     | －     | 注文キャンセル処理を行う                                                                                                                                        |
| 6     | お客様に自動でメールが送信されます。 | －                                                                                        | O     | テキスト       |     －    |     －    |      －   | 顧客宛に注文をキャンセルした旨のメールを送信する                                                                                                                                                                |
| 7     | xボタン                              | －                                                                                        | O     | ボタン         | －     | －     | －     | 注文キャンセルモーダルを閉じる                                                                                                                                  |
| 8     | 保留／解除                           | －                                                                                        | O     | ボタン         | －     | －     | －     | 保留変更モーダルまたは保留解除モーダルを表示する                                                                                                                                      |
| 9     | 保留に変更                           | －                                                                                        | O     | ラベル         | －     | －     | －     | 現在保留中では無い場合                                                                                                                                          |
| 10    | (保留理由のメモ)                     | order.note                                                                                | I     | テキストエリア | －     | －     | －     | プレースホルダは「メモを記載」                                                                                                                                  |
| 11    | 注文を保留にする                     | －                                                                                        | O     | ボタン       | －     | －     | －     | 注文を保留に変更する処理をする                                                                                                                                  |
| 12    | xボタン                              | －                                                                                        | O     | ボタン         | －     | －     | －     | 保留変更モーダルを閉じる                                                                                                                                        |
| 13    | 保留を解除                           | －                                                                                        | O     | ラベル         | －     | －     | －     | 現在保留中の場合                                                                                                                                       |
| 14    | (解除理由のメモ)                     | order.note                                                                                | I     | テキストエリア | －     | －     | －     | プレースホルダは「メモを記載」                                                                                                                                  |
| 15    | 保留を解除する                       | －                                                                                        | O     | ボタン         | －     | －     | －     | 保留を解除する処理をする                                                                                                                                        |
| 16    | xボタン                              | －                                                                                        | O     | ボタン         | －     | －     | －     | 保留解除モーダルを閉じる                                                                                                                                        |

### 1.2.4. イベント定義

| No  | 項目            | 発生条件 | 遷移先         | 備考                              | API |
| --- | --------------- | -------- | -------------- | --------------------------------- | --- |
| 1   | 「注文キャンセル」ボタン            | クリック | 注文キャンセルモーダル             |     |  |
| 2   | 「注文キャンセルを確定」ボタン | クリック | [注文詳細画面](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-0032.M3.2:%E6%B3%A8%E6%96%87%E8%A9%B3%E7%B4%B0_ver2.0)            | 注文キャンセル処理を行い注文詳細画面を再描画する<br>注文キャンセル時に顧客に注文をキャンセルした旨のメールを送信する | 注文キャンセルAPI |
| 3   | 「保留/解除」ボタン | クリック | 保留変更モーダルまたは保留解除モーダル            | 現在が保留中ではなければ保留変更モーダル、保留中なら保留解除モーダルを表示する |  |
| 4   | 「注文を保留にする」ボタン      | クリック | [注文詳細画面](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-0032.M3.2:%E6%B3%A8%E6%96%87%E8%A9%B3%E7%B4%B0_ver2.0)   | 注文を保留にする処理を行い注文詳細画面を再描画する | 注文保留API |
| 5   | 「保留を解除する」ボタン          | クリック | [注文詳細画面](https://github.com/grrowjp/Meeth/wiki/%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E5%86%8D%E6%A7%8B%E7%AF%89-0032.M3.2:%E6%B3%A8%E6%96%87%E8%A9%B3%E7%B4%B0_ver2.0)    |  注文の保留を解除する処理を行い注文詳細画面を再描画する                  | 注文保留解除API |
| 6   | xボタン          | クリック | ー   |  モーダルを閉じる              |  |

## 1.3. API

### 1.3.1. API一覧

| NO. | 名称 | 内容 |
|-|-|-|
| 1 | 注文キャンセルAPI | 注文キャンセル処理を行う |
| 2 | 注文保留API | 注文の保留処理を行う |
| 3 | 注文保留解除API | 注文の保留解除処理を行う |

